{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="{% static 'icons/1929_dev_fevicon2.jpg' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    {% comment %} <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script> {% endcomment %}
    
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <title>1929 </title>
    <link rel="stylesheet" href="{% static 'css/fontstyle.css' %}">


    <style>
        body {
            margin: 0;
            padding: 0;
            border: 0;
            width: 100%;
            height: 100%;
            font-family: 'IBMPlexSansArabic', 'SF Pro Display', sans-serif;

            
        }
        
        button {
            cursor: pointer;
        }
        
        .container {
            display: flex;
            justify-content: center;
            width: 100%;
            height: 100vh;
        }
        
        
        .right-image > img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            
        }
        
        .left-section {
            padding: 5%;
            box-sizing: border-box;
        }
        
        .recover_password {
            display: flex;
            align-items: center;
            margin-bottom: 10%;
            margin-top: 10%
        }
        
        .recover-font {
            margin-left: 10px;
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .label-font {
            font-size: 1em;
            margin-bottom: 5px;
        }
        .margin_top{
            margin-top:5%;
        }
        input{
            width : 517px;
            height : 40px;
            border-radius: 10px
        }






        #sendlink_btn {
            padding: 15px;
            margin: 10px 0;
            background-color: #85080C;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
       

        #cancel_button{
            padding: 15px;
            margin: 10px 0;
            color: #85080C;
            border: 2px solid #85080C;
            background-color: white;
            border-radius: 5px;
            cursor: pointer;

        }
        
        button {
            display:flex;
            align-items:center;
            justify-content: center;
            width : 517px;
            height : 40px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        
       
    
       



               
        .modal-scope .modal {
            display: none;
            position: fixed;
            z-index: 1050;
            left: 0;
            top: 0;
            width: 25%;
            height: 100%;
            overflow: hidden;
            outline: 0;
        }

        .modal-scope .modal-dialog {
            position: relative;
            width: auto;
            margin: 10px;
            pointer-events: none;
        }

        .modal-scope .modal-content {
            position: relative;
            display: flex;
            flex-direction: column;
            width: 100%;
            pointer-events: auto;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid rgba(0, 0, 0, 0.2);
            border-radius: 0.3rem;
            outline: 0;
        }

        .modal-scope .modal-header,
        .modal-scope .modal-body,
        .modal-scope .modal-footer {
            padding: 1rem;
        }

        .modal-scope .modal-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            padding: 1rem;
            border-bottom: 1px solid #e9ecef;
            border-top-left-radius: calc(0.3rem - 1px);
            border-top-right-radius: calc(0.3rem - 1px);
        }

        .modal-scope .modal-title {
            margin-bottom: 0;
            line-height: 1.5;
        }

        .modal-scope .close {
            padding: 1rem;
            margin: -1rem -1rem -1rem auto;
            cursor: pointer;
        }

        .modal-scope .modal-body {
            position: relative;
            flex: 1 1 auto;
            padding: 1rem;
        }

        .modal-scope .modal-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 1rem;
            border-top: 1px solid #e9ecef;
            border-bottom-right-radius: calc(0.3rem - 1px);
            border-bottom-left-radius: calc(0.3rem - 1px);
        }

        .modal-scope .btn {
            display: inline-block;
            font-weight: 400;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            user-select: none;
            border: 1px solid transparent;
            padding: 0.375rem 0.75rem;
            font-size: 1rem;
            line-height: 1.5;
            border-radius: 0.2rem;
            transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .modal-scope .btn-secondary {
            color: #fff;
            background-color: #85080C;
            border-color: #85080C;
        }
        .input-container {
            position: relative;
            display: inline-block;
        }
        
        .input-container .toggle-password,
        .input-container .toggle-password-two{
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            cursor: pointer;
        }

        @media (max-width: 450px) {
            .container {
                flex-direction: column;
                justify-content: flex-start;
                align-items: center;
            }
    
            .right-image {
                display: none;
            }
    
            .left-section {
                width: 90%;
                padding: 10%;
            }
    
            input {
                width: 100%;
            }
            .input-container{
                width: 100%
            }
            button {
                width: 100%;
            }
            .recover_password{
                margin-bottom: 20%;
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                justify-content: flex-start;
                align-items: center;
            }
    
            .right-image {
                display: block;
                width: 100%;
                height: 50vh;
            }
    
            .left-section {
                width: 90%;
                padding: 10%;
            }

    
            .input-container{
                width: 100%
            }
    
            input {
                width: 100%;
            }
    
            button {
                width: 100%;
            }
        }
    
        @media (max-width: 800px) {
            .container {
                flex-direction: column;
                justify-content: flex-start;
                align-items: center;
            }
    
            .right-image {
                display: block;
                width: 100%;
                height: 50vh;
            }
    
            .left-section {
                width: 90%;
                padding: 10%;
            }

            .input-container{
                width: 100%
            }
    
            input {
                width: 100%;
            }
    
            button {
                width: 100%;
            }
        }
    
        @media (max-width: 900px) {
            .container {
                flex-direction: column;
                justify-content: flex-start;
                align-items: center;
            }
    
            .right-image {
                display: block;
                width: 100%;
                height: 50vh;
            }
    
            .left-section {
                width: 90%;
                padding: 10%;
            }

            .input-container{
                width: 100%
            }
    
            input {
                width: 100%;
            }
    
            button {
                width: 100%;
            }
        }
    
        @media (max-width: 1536px) {
            .container {
                flex-direction: row;
                justify-content: center;
                align-items: center;
            }
    
            .right-image {
                display: block;
                width: 50%;
                height: 100vh;
            }
    
            .left-section {
                width: 50%;
                padding: 5%;
            }

            .input-container{
                width: 100%
            }
    
            input {
                width: 100%;
            }
    
            button {
                width: 100%;
            }
        }
    
        @media (max-width: 2048px) {
            .container {
                flex-direction: row;
                justify-content: center;
                align-items: center;
            }
    
            .right-image {
                display: block;
                width: 50%;
                height: 100vh;
            }
    
            .left-section {
                width: 50%;
                padding: 5%;
            }

            .input-container{
                width: 100%
            }
    
            input {
                width: 100%;
            }
    
            button {
                width: 100%;
            }
        }
    
        @media (max-width: 2732px) {
            .container {
                flex-direction: row;
                justify-content: center;
                align-items: center;
            }
    
            .right-image {
                display: block;
                width: 50%;
                height: 100vh;
            }
    
            .left-section {
                width: 50%;
                padding: 5%;
            }

            .input-container{
                width: 100%
            }
    
            input {
                width: 100%;
            }
    
            button {
                width: 100%;
            }
        }

        .error-message {
            color: red;
            margin-top: 5px;
        }

        .success-message {
            color: green;
            margin-top: 5px;
        }



    </style>
</head>
<body>
    <div class="container">
        <div class="left-section">
            <img src="{% static 'icons/Booking Logo PNG Black 1.png' %}" alt="1929 Logo" style="width: 90px; height: 60px; margin-bottom: 50px;">
            <div class="recover_password">
                <img src="{% static 'icons/mdi_key.png' %}" alt="1929 Logo">
                <div class="recover-font">Recover Password</div>
            </div>
            <div class="margin_top">
                <div>
                    <label for="password1" class="label-font">Enter New Password</label>
                </div>
                <div class="input-container">
                    <input id="password1" type="password" placeholder="Enter password" name="password1" required>
                    <span toggle="#password1" class="fa fa-fw fa-eye-slash field-icon toggle-password"></span>
                </div>
                <div id="password1-error" class="error-message"></div>
            </div>
            <div class="margin_top">
                <div>
                    <label for="password2" class="label-font">Confirm Password</label>
                </div>
                <div class="input-container">
                    <input id="password2" type="password" name="password2" placeholder="Confirm password" required>
                    <span toggle="#password2" class="fa fa-fw fa-eye-slash field-icon toggle-password-two"></span>
                </div>
                <div id="password2-error" class="error-message"></div>
            </div>
            <br><br>
            <div>
                <button type="button" id="sendlink_btn" data-id="{{ id }}" data-token="{{ token }}" onclick="resetpassword(this.getAttribute('data-id'), this.getAttribute('data-token'))">Confirm</button>
                <button type="button" id="cancel_button">Cancel</button>
            </div>
            <br><br>
            <div id="reset-success" class="success-message"></div>
        </div>
        <div class="right-image">
            <img src="{% static 'icons/Screenshot 2024-04-03 120308 1.png' %}" alt="Background Image">
        </div>
    </div>

    <div class="modal-scope">
        <div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="errorModalLabel" aria-hidden="true" style="margin-left: 40%;">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="errorModalLabel">Reminder</h5>
                    </div>
                    <div class="modal-body">
                        {{ message }}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function(){
            $('#cancel_button').click(function(event){
                event.preventDefault();
                window.close(); 
            });

            $(".toggle-password, .toggle-password-two").click(function() {
                $(this).toggleClass("fa-eye fa-eye-slash");
                var input = $($(this).attr("toggle"));
                if (input.attr("type") === "password") {
                    input.attr("type", "text");
                } else {
                    input.attr("type", "password");
                }
            });
        });


        function validatePassword(password) {
            var regex = /^(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{6,}$/;
            return regex.test(password);
        }

        function displayError(elementId, message) {
            document.getElementById(elementId).innerText = message;
        }

        function clearErrors() {
            displayError('password1-error', '');
            displayError('password2-error', '');
        }

        function resetpassword(id, token) {
            clearErrors();
            var password1 = document.getElementById('password1').value;
            var password2 = document.getElementById('password2').value;
            var hasError = false;

            if (!validatePassword(password1)) {
                displayError('password1-error', 'Password must contain at least one number, one special character, and be at least 6 characters long.');
                hasError = true;
            }

            if (password1 !== password2) {
                displayError('password2-error', 'Passwords do not match.');
                hasError = true;
            }

            if (hasError) {
                return;
            }

            var url = `/api/reset-password/${id}/${token}/`;

            $.ajax({
                url: url,
                type: 'post',
                headers: {"X-CSRFToken": $(`{% csrf_token %}`).val()},
                data: {
                    'password': password1,
                    'confirm_password': password2
                },
                success: function(response) {
                    console.log('Success:', response);
                    displayError('reset-success', 'Password reset successful. This tab will close shortly.');
                    setTimeout(function() {
                        window.close();
                    }, 3000); // Closes the tab after 3 seconds
                },
                error: function(error) {
                    console.log('Error:', error);
                    displayError('reset-success', 'An error occurred during password reset. Please try again.');
                }
            });
        }
    </script>
</body>
</html>