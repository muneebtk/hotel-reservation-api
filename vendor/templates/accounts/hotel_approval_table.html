<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins">
    <link rel="icon" type="image/x-icon" href="{% static 'icons/1929_dev_fevicon2.jpg' %}">
    <script src="https://kit.fontawesome.com/6c3486d068.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{% static 'css/fontstyle.css' %}">


    <style>
        /* body,h1,h2,h3,h4,h5 {font-family: "Poppins", sans-serif} */
        body {
            font-size:16px;
            background-color: rgb(233, 228, 228);
            font-family: 'IBMPlexSansArabic', 'SF Pro Display', sans-serif;
 
        }
        button{
            cursor: pointer;
        }
        .w3-sidebar{
            background-color: #85080C;
            color: white;
        }
        /* .bg-table-head {
            --bs-table-color: #fff;
            --bs-border-radius: 30px;
        } */

        table {
            border-collapse: separate;
            border-spacing: 0;
            overflow: hidden;
        }

        th {
            background-color: #FFD6D6;
            text-align: left;
        }

        th, td {
            padding: 10px;
            border: none;
            /* border-right: 1px solid rgba(0, 0, 0, 0.5); */
        }


        thead:first-child th:first-child {
            border-top-left-radius: 15px;
        }

        tr:first-child th:last-child {
            border-top-right-radius: 15px;
        }

        tr:last-child td:first-child {
            border-bottom-left-radius: 15px;
        }

        tr:last-child td:last-child {
            border-bottom-right-radius: 15px;
        }


        /* Borders */
        .user-brd {
            border: 1px solid #D2D2D2;
        }
        .table-body-brd {
            border-left: 1px solid #D2D2D2;
            border-right: 1px solid #D2D2D2;
            border-bottom: 1px solid #D2D2D2;
        }

        /* .table-responsive {
                width: 100%;  Adjust as needed 
            }
            
            .table {
                width: 100%;  Adjust as needed 
            } */

        /* ############################### */


        .col-md-4 {
        display: inline-block;
        margin-right: 28px;
        }

        .btn{
            border-radius: 10px;
            padding: 10px;
            border: none;
            background-color: white;
        }

        .active{
            background-color: #85080C;
            color: white;
        }
        /* td{
            margin-left: 10px;
        } */
        
        .table-body-color{
            background-color: #FFF6F6;

        }
        .container-box{
            /* margin-top:20px; */
            padding: 20px;
        }
        .row-main{
            border-radius: 10px;
            padding: 20px;
            background-color: white;
        }
        .form-select{
            padding: 10px;
            border-radius: 10px;
            border-color: #FFD6D6;
            background-color: white;
        }
        .btn-blue{
            padding: 10px;
            padding-left: 10px;
            padding-right: 10px;
            border-radius: 32px;
            border-color: #85080C;
            background-color: white;
            color: #85080C;
            width: 200px;
            cursor: pointer;
        }
        .border-right{
            border-right: 1px solid #BCBCBC;
            
        }
        .color-grey{
            color: #717171;
        }
        
        .btn-search{
            padding: 10px;
            border-radius: 32px;
            width: 200px;
            border: none;
            margin-left: 30px;
            text-align: left;
            background-color: #D2D2D2
        }
        .brown{
            background-color: #85080C;
        }
        .box_container_input{
            background-color: #EDF0F9; 
            width: 250px; 
            border: none;  
            margin-right: 40px;
        }
        /* new changes */
        ul{
            list-style-type: none;
        }
        .upload_button{
            width: 450px;
        }
        .row{
            text-align: center;

        }
        .responsive-table{
            width: 90%;
           margin-left: auto; 
           margin-right: auto;
            
        }
        .col_width{
            width: 320px;
            height: 60px;
        }


        #loader {
            color: #85080C;
            font-size: 10px;
            width: 1em;
            height: 1em;
            border-radius: 50%;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            text-indent: -9999em;
            animation: mulShdSpin 1.3s infinite linear;
            z-index: 9999; /* Ensure loader is above other content */
        }


            @keyframes mulShdSpin {
            0%,
            100% {
                box-shadow: 0 -3em 0 0.2em, 
                2em -2em 0 0em, 3em 0 0 -1em, 
                2em 2em 0 -1em, 0 3em 0 -1em, 
                -2em 2em 0 -1em, -3em 0 0 -1em, 
                -2em -2em 0 0;
            }
            12.5% {
                box-shadow: 0 -3em 0 0, 2em -2em 0 0.2em, 
                3em 0 0 0, 2em 2em 0 -1em, 0 3em 0 -1em, 
                -2em 2em 0 -1em, -3em 0 0 -1em, 
                -2em -2em 0 -1em;
            }
            25% {
                box-shadow: 0 -3em 0 -0.5em, 
                2em -2em 0 0, 3em 0 0 0.2em, 
                2em 2em 0 0, 0 3em 0 -1em, 
                -2em 2em 0 -1em, -3em 0 0 -1em, 
                -2em -2em 0 -1em;
            }
            37.5% {
                box-shadow: 0 -3em 0 -1em, 2em -2em 0 -1em,
                3em 0em 0 0, 2em 2em 0 0.2em, 0 3em 0 0em, 
                -2em 2em 0 -1em, -3em 0em 0 -1em, -2em -2em 0 -1em;
            }
            50% {
                box-shadow: 0 -3em 0 -1em, 2em -2em 0 -1em,
                3em 0 0 -1em, 2em 2em 0 0em, 0 3em 0 0.2em, 
                -2em 2em 0 0, -3em 0em 0 -1em, -2em -2em 0 -1em;
            }
            62.5% {
                box-shadow: 0 -3em 0 -1em, 2em -2em 0 -1em,
                3em 0 0 -1em, 2em 2em 0 -1em, 0 3em 0 0, 
                -2em 2em 0 0.2em, -3em 0 0 0, -2em -2em 0 -1em;
            }
            75% {
                box-shadow: 0em -3em 0 -1em, 2em -2em 0 -1em, 
                3em 0em 0 -1em, 2em 2em 0 -1em, 0 3em 0 -1em, 
                -2em 2em 0 0, -3em 0em 0 0.2em, -2em -2em 0 0;
            }
            87.5% {
                box-shadow: 0em -3em 0 0, 2em -2em 0 -1em, 
                3em 0 0 -1em, 2em 2em 0 -1em, 0 3em 0 -1em, 
                -2em 2em 0 0, -3em 0em 0 0, -2em -2em 0 0.2em;
            }
            }
        
        /* responsive table width reduced */
        @media (max-width: 1440px) {
            .container-box{
                width: 1300px;
            }
            .row-main{
                width: 1300px;
            }
            .table-container {
                width: 1270px;
                overflow-x: auto;
            }

            .responsive-table {
                width: 1200px;
                
            }
        }
        /* responsive table width reduced */
        @media (max-width: 1024px) {
            .container-box{
                width: 900px;
            }
           .row-main{
               width: 900px;
           }
           .table-container {
               width: 860px;
               overflow-x: auto;
           }

           .responsive-table {
               width: 860px;
           }
           .col-md-4{
                padding-bottom: 5px;
            }
            .col_width{
                width: 215px;
            }
            
       }
       @media (max-width: 768px) {
            .container-box{
                width: 730px;
            }
            
            .row-main{
                width: 730px;
                
            }
            .table-container {
                width: 690px;
                overflow-x: auto;
            }
           
            .responsive-table {
                width: 690px;
            }
            .box_container{
                display: flex;
                margin-bottom: 10px;
            }
            
        }
        @media (max-width: 425px) {
            .container-box{
                width: 380px;
            }
            .btn-search{
                width: 150px;
            }
            .row-main{
                width: 380px;
            }
            .table-container {
                width: 350px;
                overflow-x: auto;
            }

            .responsive-table {
                width: 350px;
            }
            .box_container_input{
                width: 150px;
            }
        }
        @media (max-width: 375px) {
            .container-box{
                width: 345px;
            }
            .btn-search{
                width: 120px;
                
            }
            .input-size{
                width: 40px;
            }
            .row-main{
                width: 345px;
            }
            .table-container {
                width: 310px;
                overflow-x: auto;
            }

            .responsive-table {
                width: 310px;
            }
            
            
        }
        @media (max-width: 320px) {
            .container-box{
                width: 270px;
            }
            .btn-search{
                width: 118px;
                margin-left: 4px;
                
            }
            .profile-btn{
                padding: 10px;
              
            }
            .search-btn{
                margin-right: auto;
            }
            .input-size{
                width: 20px;
            }
            .empty-container{
                width: 1px;
            }
            .row-main{
                width: 270px;
            }
            .table-container {
                width: 240px;
                overflow-x: auto;
            }

            .responsive-table {
                width: 240px;
            }
            
        }
        .blurred {
            filter: blur(5px);
            pointer-events: none;
        }
        
    </style>
</head>
<body>

        <div id="loader" style="display: none;"></div>

        <div class="w3-main" style="margin-left:40px; margin-top:auto">
                <div class="container container-box">
                    <div class=" justify-content-center">
                        <div class="" >
                            <div class="col-md-4"> 
                                <button class="w3-badge w3-xlarge  w3-white" style="border: none;"><a href="{%url 'hotel_table_list'%}" style="text-decoration: none;"><i class="fa-solid fa-arrow-left fa-lg " ></i></a></button>
                            </div>    
                        </div>
                        <br>
                        <div class="row-main" id="hotelTable">
                            <br>
                            <div class="col-md-12 ">
                                <div class="table-container " >
                                    <table class="w3-table  responsive-table " >
                                        <thead class=" bg-table-head">
                                            <tr>
                                                <th class="border-right col_width">Hotel Name</th>
                                                <th class="border-right col_width">Hotel Owner Name</th>
                                                <th class="border-right col_width">Hotel Owner Email</th>
                                                <th class="col_width" >Office Number</th>
                                            </tr>
                                        </thead>
                                        <tbody class="fs12 table-body-color">
                                        <div class="col-md-4" >                
                                            <tr>
                                                <td class="border-right col_width">{{data.name}}</td>
                                                <td class="border-right col_width">{{data.vendor.user.first_name}}</td>
                                                <td class="border-right col_width">{{data.vendor.user.email}}</td>
                                                <td class="col_width">{{data.office_number}}</td>
                                            </tr>
                                        </div> 
                                        </tbody>
                                    </table>

                                    <table class="w3-table responsive-table ">
                                        <thead class=" bg-table-head">
                                            <tr>
                                                <th class="border-right col_width">GSM Number</th>
                                                <th class="border-right col_width">Hotel Address</th>
                                                <th class="border-right col_width">Country</th>
                                                <th class="col_width">State/ Province</th>
                                            </tr>
                                        </thead>
                                        <tbody class="fs12 table-body-color">
                                        <div class="col-md-4" >                
                                            <tr>
                                                <td class="border-right col_width">{{data.vendor.gsm_number}}</td>
                                                <td class="border-right col_width">{{data.address}}</td>
                                                <td class="border-right col_width">{{data.country}}</td>
                                                <td class="col_width">{{data.state}}</td>
                                            </tr>
                                        </div> 
                                        </tbody>
                                    </table>
                                    <table class="w3-table responsive-table ">
                                        <thead class=" bg-table-head">
                                            <tr>
                                                <th class="border-right col_width">City</th>
                                                <th class="border-right col_width">Postal/ZIP Code</th>
                                                <th class="border-right col_width">Number of Rooms</th>
                                                <th class="col_width">Room Type</th>
                                                
                                            </tr>
                                        </thead>
                                        <tbody class="fs12 table-body-color">
                                        <div class="col-md-4" >                
                                            <tr>
                                                <td class="border-right col_width">{{data.city}}</td>
                                                <td class="border-right col_width">{{data.city.postal_code}}</td>
                                                <td class="border-right col_width">{{data.number_of_rooms}}</td>
                                                <td class="col_width">{{data.room_types.all|join:", "}}</td>
                                            </tr>
                                        </div>  
                                        </tbody>
                                    </table>
                                    <table class="w3-table responsive-table ">
                                        <thead class=" bg-table-head">
                                            <tr>
                                                <th class="border-right col_width">Hotel Rating</th>
                                                <th class="border-right col_width">CR Number</th>
                                                <th class="border-right col_width">Date of Expiry</th>
                                                <th class="col_width">VAT Number</th>
                                            </tr>
                                        </thead>
                                        <tbody class="fs12 table-body-color">
                                        <div class="col-md-4" >                
                                            <tr>
                                                <td class="border-right col_width">{{data.hotel_rating}} star</td>
                                                <td class="border-right col_width">{{data.cr_number}}</td>
                                                <td class="border-right col_width">{{data.date_of_expiry}}</td>
                                                <td class="col_width">{{data.vat_number}}</td>
                                            </tr>
                                        </div> 
                                        </tbody>
                                    </table>
                                </div>
                                <!-- <div class="row w3-margin-top">
                                    <button onclick="fetch_status(this.getAttribute('hotel_id'),this.getAttribute('status'),this.getAttribute('data-email'))" hotel_id="{{data.id}}" data-email="{{data.vendor.user.email}}" status="False" class="w3-round-large w3-margin-right w3-margin-bottom  btn  w3-padding-large " style="border: 1px solid brown; color: brown;">Reject</button>
                                    <button onclick="fetch_status(this.getAttribute('hotel_id'),this.getAttribute('status'),this.getAttribute('data-email'))" hotel_id="{{data.id}}" data-email="{{data.vendor.user.email}}" status="True" class="btn active w3-padding-large">Approve</button>
                                </div> -->
                                <div class="row w3-margin-top">
                                    {% if not data.approved %}
                                        <button onclick="fetch_status(this.getAttribute('hotel_id'),this.getAttribute('status'),this.getAttribute('data-email'))"
                                                hotel_id="{{ data.id }}"
                                                data-email="{{ data.vendor.user.email }}"
                                                status="False"
                                                class="w3-round-large w3-margin-right w3-margin-bottom btn w3-padding-large"
                                                style="border: 1px solid brown; color: brown;">
                                            Reject
                                        </button>
                                        <button onclick="fetch_status(this.getAttribute('hotel_id'),this.getAttribute('status'),this.getAttribute('data-email'))"
                                                hotel_id="{{ data.id }}"
                                                data-email="{{ data.vendor.user.email }}"
                                                status="True"
                                                class="btn active w3-padding-large">
                                            Approve
                                        </button>
                                    {% else %}
                                        <p>The hotel has already been approved.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </div>



        <!-- Rejection modal -->


        <div id="remark_rejection" class="w3-modal">
            <div class="w3-modal-content w3-card-4 w3-round-xlarge" style="max-width:25%; margin: auto; padding: 20px;">
                <div class="w3-center"><br>
                    <span onclick="document.getElementById('remark_rejection').style.display='none'"
                          class="w3-button w3-xlarge w3-hover-red w3-display-topright" title="Close Modal">&times;</span>
                </div>
                <div class="w3-margin-left">
                    <h3 class="w3-margin">Write Rejection Remark</h3>
                    <form id="responseForm" class="w3-container" action="" method="post">
                        {% csrf_token %}
                        <input type="hidden" id="hotel_id_input" name="hotel_id" value="">
                        <input type="hidden" id="email_input" name="email" value="">
                        <div class="w3-section w3-margin-left">
                            <div class="w3-cell">
                                <div>
                                    <textarea class="w3-padding w3-round-large box_container_input" id="respond" name="respond"
                                              placeholder="Enter rejection reason" style="width: 100%; height: 100px;"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="w3-center w3-container w3-margin-top">
                            <button class="w3-round-large w3-margin-right btn w3-padding-large"
                                    onclick="document.getElementById('remark_rejection').style.display='none'"
                                    style="border: 1px solid #85080C; color: #85080C;" type="button">Cancel</button>
                            <button class="w3-round-large active btn w3-section w3-padding-large" type="submit">Post</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        

        
        


        <script type="text/javascript">
            window.CSRF_TOKEN = '{{ csrf_token }}';
        </script>            
    
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        
        function w3_open() {
        document.getElementById("mySidebar").style.display = "block";
        document.getElementById("myOverlay").style.display = "block";
        }
        
        function w3_close() {
        document.getElementById("mySidebar").style.display = "none";
        document.getElementById("myOverlay").style.display = "none";
        }
        
        // function fetch_status(id,status,email){
        //     console.log(id,status);
        //     $('#loader').show();
        //     $('#hotelTable').addClass('blurred');


        //     $.ajax({
        //         url : '/vendor/hotel/approval/' + id + '/',
        //         method : "POST",
        //         headers: {
        //             'X-CSRFToken': window.CSRF_TOKEN
        //         },
        //         data:{

        //             approved_status:status,
        //             email: email
        //         },

        //         success : function(response){
        //             console.log("success");

        //             window.location.href = '/vendor/hotel/table/list/'; 
        //             // window.history.back();
        //         },
        //         error: function() {
        //             alert('Failed to fetch details.');
        //         }
        //     })
        // }



        function fetch_status(id, status, email) {
            if (status === "False") {
                document.getElementById('remark_rejection').style.display = 'block';

                document.getElementById('hotel_id_input').value = id;
                document.getElementById('email_input').value = email;
            } else {
                sendApprovalStatus(id, status, email, "");
            }
        }

        function sendApprovalStatus(id, status, email, remark) {
            $('#loader').show();
            $('#hotelTable').addClass('blurred');

            $.ajax({
                url: '/vendor/hotel/approval/' + id + '/',
                method: "POST",
                headers: {
                    'X-CSRFToken': window.CSRF_TOKEN
                },
                data: {
                    approved_status: status,
                    email: email,
                    remark: remark
                },
                success: function (response) {
                    console.log("success");
                    window.location.href = '/vendor/hotel/table/list/';
                },
                error: function () {
                    alert('Failed to fetch details.');
                }
            });
        }

        document.getElementById('responseForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const id = document.getElementById('hotel_id_input').value;
            const email = document.getElementById('email_input').value;
            const remark = document.getElementById('respond').value;

            sendApprovalStatus(id, "False", email, remark);
            document.getElementById('remark_rejection').style.display = 'none';
        });

        
    </script>
    
</body>
</html>