{% load i18n %}
{% load static %}
<!DOCTYPE html>
<html lang="{{ request.LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="{% static 'css/pagination-styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/view-edit-btn.css' %}">
    <link rel="stylesheet" href="{% static 'css/utilsclasses.css' %}">
    <link rel="icon" type="image/x-icon" href="{% static 'icons/1929_dev_fevicon2.jpg' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins">
    <script src="https://kit.fontawesome.com/6c3486d068.js" crossorigin="anonymous"></script>
    <!-- Include Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <!-- Include Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="{% static 'css/fontstyle.css' %}">
    <link rel="stylesheet" href="{% static 'chalets/css/chalet_offer_promotion.css' %}">
</head>
<body>
    <!-- Sidebar/menu -->
    {% include 'chalets_accounts/chalat_logo.html' %}
    {% include 'accounts/search_navbar.html' %} 

    <div class="loader">
        <div id="loader"></div>
    </div>
    <div class="w3-overlay w3-hide-large cursor-pointer" onclick="w3_close()"  title="close side menu" id="myOverlay"></div>
        <div class="w3-main main-section">

                <div class="container container-box">
                    <div class="row justify-content-center">
                        <div class="row-main" id="hotelTable">
                            <h4>{% trans 'Offer Creation And Management' %}</h4>
                            <div class="container">
                                <div class="row">
                                    <div class="col-12 col-md-8">
                                        <div class="select-container">
                                            <!-- <div class="col-md-4">
                                    
                                                <form >
                   
                                                    <input type="text" ondblclick="resetDate('datePicker')" id="datePicker" class="form-select select_fromdate fs12 text-black"  style="width: 180px;" name="date" placeholder="{% trans 'From: Sep 8, 2023' %}">
                                                    
                                                </form>
                                               
                                            </div>
                                            <div class="col-md-4">
                                                <form >
                                                    <input type="text" ondblclick="resetDate('datePicker1')" id="datePicker1" class="form-select select_todate fs12 text-black"  style="width: 180px;" name="date" placeholder="{% trans 'To: Sep 8, 2023' %}">
                                                </form>
                                            </div> -->
                                            <div class="col-md-4 select_discount-container">
                                                <select aria-label="Default select example" class="form-select select_discount select fs12 text-black white" id="select_discount">
                                                    <option value="common">{% trans "Common Promotion" %}</option>
                                                    <option value="promo_code">{% trans "Promo Code Specific" %}</option>
                                                    {% comment %} <option value="targeted_offers">{% trans "Targeted Offers" %}</option>
                                                    <option value="seasonal_event">{% trans "Seasonal & Special Events" %}</option>
                                                    <option value="loyalty_program">{% trans "Referral & Loyalty Programs" %}</option> {% endcomment %}
                                                </select>
                                            </div>
                                            <div class="col-md-4">
                                                <button class=" btn-blue px-3 f search_button" type="button">
                                                    <i class="fa-solid fa-magnifying-glass"></i> {% trans 'Search' %}
                                                </button>
                                            </div>
                                            <div class="col-md-4 float-right">
                                                <button class="btn btn-red px-3 active" type="button"  id="openModalButton">
                                                    {% trans 'Create New Offer' %}
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <div class="col-md-12">
                                <div class="table-responsive table-container">
                                    <table class="w3-table text-center responsive-table">
                                        <thead class="bg-table-head">
                                            <tr>
                                                
                                                <th class="border-right">{% trans "Sl. No." %}</th>
                                                <th class="border-right">{% trans "Offer Name" %}</th>
                                                <th class="border-right">{% trans "Description" %}</th>
                                                <th class="border-right">{% trans "Discount Percentage" %}</th>
                                    
                                                {% if discount == 'promo_code' %}
                                                    <th class="border-right">{% trans "Promo Code" %}</th>
                                                    <th class="border-right">{% trans "Max Uses" %}</th>
                                                    <th class="border-right">{% trans "Validity Period" %}</th>
                                                {% elif discount == 'targeted_offers' %}
                                                    <th class="border-right">{% trans "Targeted Offer Type" %}</th>
                                                {% elif discount == 'seasonal_event' %}
                                                    <th class="border-right">{% trans "Occasion Name" %}</th>
                                                {% elif discount == 'loyalty_program' %}
                                                    <th class="border-right">{% trans "Points Required" %}</th>
                                                {% else %}
                                                    <th class="border-right">{% trans "Minimum Spend" %}</th>
                                                    <th class="border-right">{% trans "Validity Period" %}</th>
                                                {% endif %}
                                                <th colspan="2"> {% trans "Action" %}</th>
                                            </tr>
                                        </thead>
                                        <tbody class="fs12 table-body-color">
                                            {% if offers %}
                                                {% for offer in offers %}
                                                    <tr>
                                                        <td class="border-right">{{ forloop.counter }}</td>
                                                        <td class="border-right">{{ offer.title }}</td>
                                                        <td class="border-right">{{ offer.description|capfirst }}</td>
                                                        <td class="border-right">{% if offer.discount_percentage %}{{ offer.discount_percentage }} % {% else %} - {% endif %}</td>
                                                        {% if discount == 'promo_code' %}
                                                            <td class="border-right">{{ offer.promo_code }}</td>
                                                            <td class="border-right">{{ offer.max_uses }}</td>
                                                            <td class="border-right">{{ offer.start_date }} to {{ offer.end_date }}</td>
                                                        {% elif discount == 'targeted_offers' %}
                                                            <td class="border-right">{{ offer.get_promotion_type_display }}</td>
                                                        {% elif discount == 'seasonal_event' %}
                                                            <td class="border-right">{{ offer.occasion_name }}</td>
                                                        {% elif discount == 'loyalty_program' %}
                                                            <td class="border-right">{{ offer.points_required }}</td>
                                                        {% else %}
                                                            <td class="border-right">{% if offer.minimum_spend %}{{ offer.minimum_spend }} {% else %} - {% endif %}</td>
                                                            <td class="border-right">{{ offer.start_date }} to {{ offer.end_date }}</td>
                                                        {% endif %}
                                                        {% if offer.source == 'admin' %}
                                                        <td class="color-grey inline-flex">{% trans 'Created by' %} {{ offer.source }}</td>
                                                        {% else %} 
                                                        <td class="color-grey inline-flex">
                                                            <div class="table-action-btn-container">
                                                                <a href="#" class="edit-offer textdecoration-none view-btn" data-offer-id="{{ offer.id }}">
                                                                    <i class="fa-solid fa-pen"></i>{% trans 'Edit' %}
                                                                </a>
                                                                <a href="#" class="delete-offer textdecoration-none delete-btn" data-delete-id="{{ offer.id }}">
                                                                    <i class="fa-solid fa-trash"></i>{% trans 'Delete' %}
                                                                </a>
                                                            </div>
                                                        </td>
                                                        {% endif %}
                                                    </tr>
                                                {% endfor %}
                                            {% else %}
                                                <tr>
                                                    <td colspan="12" class="text-center">{% trans "No data found" %}</td>
                                                </tr>
                                            {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="no_data_found hidden"></div>
                <div id="pagination-container">
                {%if offers%}
                <div class="pagination">
                    <!-- Previous Button -->
                    {% if offers.has_previous %}
                    <a href="#" class="previous-page pagination-link" data-page="{{ offers.previous_page_number }}" title="Previous Page">
                        <span class="previous-button">
                                <i class="fas fa-chevron-left"></i>
                            </span>
                        </a>
                    {% else %}
                        <span class="disabled-button disabled-button-prev">
                            <i class="fas fa-chevron-left"></i>
                        </span>
                    {% endif %}                
                                    
                <div class="page-numbers">
                    {% for num in offers.paginator.page_range %}
                        {% if offers.paginator.num_pages > 3 %}
                            {% if num >= offers.number and num < offers.number|add:3 %}
                                {% if num == offers.number %}
                                    <span class="current-page">{{ num }}</span>
                                {% else %}
                                    <a href="#" class="page-button pagination-link" data-page="{{ num }}">{{ num }}</a>
                                {% endif %}
                            {% endif %}
                        {% else %}
                            {% if num == offers.number %}
                                <span class="current-page">{{ num }}</span>
                            {% else %}
                                <a href="#" class="page-button pagination-link" data-page="{{ num }}">{{ num }}</a>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                </div>
            
                <!-- Next Button -->
                {% if offers.has_next %}
                <a href="#" class="next-page pagination-link" data-page="{{ offers.next_page_number }}" title="Next Page">
                    <span class="next-button">
                            <i class="fas fa-chevron-right"></i>
                        </span>
                    </a>
                {% else %}
                    <span class="disabled-button disabled-button-next">
                        <i class="fas fa-chevron-right"></i>
                    </span>
                {% endif %}
            </div>
            {%else%}
            <div></div>
            {% endif %}              
                
            </div>  
            </div>  
        </div>
       
    <!-- ////////////         Edit modal         /////////// -->

    <div id="id02" class="modal-main">
        <div class="w3-modal-content w3-card-4 w3-round-xlarge add-modal-container">
            <div class="add-modal-header">
                <h3 class="w3-margin"> <i class="fa-solid fa-pen"></i> {% trans "Edit" %}</h3>
                <span 
                    onclick="document.getElementById('id02').style.display='none'" 
                    class="w3-button w3-xlarge w3-hover-red w3-display-topright" 
                    title="Close Modal">
                    &times;
                </span>
            </div>
            <div class="w3-margin-left form-container">
                <form class="w3-container modal-form" action="" method="post">
                    <div class="input-container">
                        <input class="w3-padding w3-round-large box_container_input hidden" type="text" id="offer_id" name="offer_id">

                        <div class="input-section">

                            <div class="w3-cell box_container">
                                <div>
                                    <label for="offer_name_edit">{% trans "Offer Name" %}</label>
                                </div>
                                <div>
                                    <input class="w3-padding w3-round-large box_container_input" type="text" id="offer_name_edit" name="offer_name_edit">
                                    <span class="error-message_edit hidden text-85080c"><small></small></span>
                                </div>
                            </div>
    
                           <div class="w3-cell box_container">
                                <div>
                                    <label for="description_edit">{% trans "Description" %}</label>
                                </div>
                                <div>
                                    <textarea class="w3-padding w3-round-large box_container_input h-100px" id="description_edit" name="description_edit" ></textarea>
                                    <span class="error-message_edit hidden text-85080c"><small></small></span>
                                </div>
                            </div>
                            
                        </div>

                        <div class="input-section">

                            <div class="w3-cell box_container">
                                <div>
                                    <label for="category">{% trans "Category" %}</label>
                                </div>
                                <div>
                                    <input class="w3-padding w3-round-large box_container_input" id="category_edit" name="category_edit" disabled>
                                    <span class="error-message_edit hidden text-85080c"><small></small></span>
                                </div>
                                </div>
                            
    
                            <!-- mandotory fields -->
                                <div class="w3-cell box_container">
                                    <div>
                                        <label for="discount_percentage_edit">{% trans "Discount Percentage" %}</label>
                                    </div>
                                    <div>
                                        <input class="w3-padding w3-round-large box_container_input" type="number" id="discount_percentage_edit" name="discount_percentage_edit"  step="0.01" min="0">
                                        <br><span class="error-message_edit hidden text-85080c"><small></small></span>
                                    </div>
                                </div>
                        </div>

                            

                        <!-- Common Promotion Fields -->
                        <div id="common_fields_edit" class="input-section">
                        
                            <div class="w3-cell box_container">
                                <div>
                                    <label for="minimum_spend_edit">{% trans "Minimum Spend" %}</label>
                                </div>
                                <div>
                                    <input class="w3-padding w3-round-large box_container_input" type="number" id="minimum_spend_edit" name="minimum_spend_edit" step="0.01">
                                    <br><span class="error-message_edit hidden text-85080c"><small></small></span>
                                </div>
                            </div>


                                <div class="w3-cell box_container">
                                    <div>
                                        <label for="validity_from_edit">{% trans "Valid From" %}</label>
                                    </div>
                                    <div>
                                        <input class="w3-padding w3-round-large box_container_input" type="date" id="validity_from_edit" name="validity_from_edit" >
                                        <span class="error-message_edit hidden text-85080c" style="display: block;"><small></small></span>
                                    </div>
                                </div>

                                <div class="w3-cell box_container">
                                    <div>
                                        <label for="validity_to_edit">{% trans "Valid To" %}</label>
                                    </div>
                                    <div>
                                        <input class="w3-padding w3-round-large box_container_input" type="date" id="validity_to_edit" name="validity_to_edit" >
                                        <span class="error-message_edit hidden text-85080c" style="display: block;"><small></small></span>
                                    </div>
                                </div>
                        </div>

                        <!-- Promo Code Specific Fields -->
                        <div id="promo_code_fields_edit" class="input-section hidden">
                            
                                <div class="w3-cell box_container">
                                    <div>
                                        <label for="promo_code_edit">{% trans "Promo Code" %}</label>
                                    </div>
                                    <div>
                                        <input id="previous_promo_code" hidden>
                                        <input class="w3-padding w3-round-large box_container_input" type="text" id="promo_code_edit" name="promo_code_edit"><br>
                                        <span class="error-message_edit hidden text-85080c"><small></small></span>
                                    </div>
                                </div>
    
                                <div class="w3-cell box_container">
                                    <div>
                                        <label for="max_uses_edit">{% trans "Max Uses" %}</label>
                                    </div>
                                    <div>
                                        <input class="w3-padding w3-round-large box_container_input" type="number" id="max_uses_edit" name="max_uses_edit">
                                        <span class="error-message_edit hidden text-85080c"><small></small></span>
                                    </div>
                                </div>
                            

                            
                                <div class="w3-cell box_container">
                                    <div>
                                        <label for="promo_validity_from_edit">{% trans "Valid From" %}</label>
                                    </div>
                                    <div>
                                        <input class="w3-padding w3-round-large box_container_input" type="date" id="promo_validity_from_edit" name="promo_validity_from_edit" ><br>
                                        <span class="error-message_edit hidden text-85080c"><small></small></span>
                                    </div>
                                </div>
    
                                <div class="w3-cell box_container">
                                    <div>
                                        <label for="promo_validity_to_edit">{% trans "Valid To" %}</label>
                                    </div>
                                    <div>
                                        <input class="w3-padding w3-round-large box_container_input" type="date" id="promo_validity_to_edit" name="promo_validity_to_edit" ><br>
                                        <span class="error-message_edit hidden text-85080c"><small></small></span>
                                    </div>
                                </div>
                        
                        </div>

                        <!-- Targeted Offers Fields -->
                        <div id="targeted_fields_edit" class="w3-margin-top hidden">
                            <!-- Add your targeted offers fields here -->
                            <div class="w3-cell box_container">
                                <div>
                                    <label for="targeted_type_edit">{% trans "Targeted Offer Type" %}</label>
                                </div>
                                <div>
                                    <select class="w3-padding w3-round-large box_container_input" id="targeted_type_edit" name="targeted_type_edit">
                                        <option value="early_bird">{% trans "Early Bird" %}</option>
                                        <option value="last_minute">{% trans "Last Minute" %}</option>
                                        <option value="family">{% trans "Family Package" %}</option>
                                        <!-- Add more options as necessary -->
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Seasonal & Special Events Fields -->
                        <div id="seasonal_event_fields_edit" class="w3-margin-top hidden">
                            <div class="w3-cell box_container">
                                <div>
                                    <label for="occasion_name_edit">{% trans "Occasion Name" %}</label>
                                </div>
                                <div>
                                    <input class="w3-padding w3-round-large box_container_input" type="text" id="occasion_name_edit" name="occasion_name_edit">
                                    <span class="error-message_edit hidden text-85080c"><small></small></span>
                                </div>
                            </div>
                        </div>

                        <!-- Referral & Loyalty Program Fields -->
                        <div id="loyalty_program_fields_edit" class="w3-margin-top hidden">
                            <div class="w3-cell box_container">
                                <div>
                                    <label for="points_required_edit">{% trans "Points Required" %}</label>
                                </div>
                                <div>
                                    <input class="w3-padding w3-round-large box_container_input" type="number" id="points_required_edit" name="points_required_edit">
                                    <span class="error-message_edit hidden text-85080c"><small></small></span>
                                </div>
                            </div>
                        </div>

                        <!-- Submit Buttons -->
                    </div>
                    <div class="add-actions-container">
                        <button class="w3-round-large w3-margin-right btn w3-padding-large border-85080c text-85080c"
                                onclick="document.getElementById('id02').style.display='none'"
                                type="button">{% trans "Cancel" %}</button>
                        <button class="w3-round-large activee btn w3-section w3-padding-large"
                                type="submit" id="saveEditedOfferBtn">{% trans "Save" %}</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    



    <!-- /////////////////////  Create modal   ////////////////////////////// -->


    <div id="id03" class="w3-modal">
        <div class="w3-modal-content w3-card-4 w3-round-xlarge add-modal-container">
            <div class="add-modal-header">
                <h3 class="w3-margin"> <i class="fa-solid fa-pen"></i> {% trans "Add" %}</h3>
                <span onclick="document.getElementById('id03').style.display='none'"
                      class="w3-button w3-xlarge w3-hover-red w3-display-topright" title="Close Modal">&times;</span>
            </div>
    
            <div class="w3-margin-left form-container">
                <form class="w3-container modal-form" id="chaletuserOfferForm" action="{% url 'chalet_offers' %}?chalet_id={{ selected_chalet.id }}" method="post" onsubmit="return validateForm();">
                    {% csrf_token %}
                    <div class="input-container">
                        <div class="input-section">
                            <!-- Offer Name -->
                            <div class="w3-cell box_container">
                                <div>
                                    <label for="offer_name">{% trans "Offer Name" %}</label>
                                </div>
                                <div>
                                    <input class="w3-padding w3-round-large box_container_input" type="text" id="offer_name" name="offer_name"
                                        placeholder="{% trans 'Enter offer name' %}">
                                    <span class="error-message hidden text-85080c"><small></small></span>
                                </div>
                            </div>
                        
                            <!-- Description -->
                            <div class="w3-cell box_container">
                                <div>
                                    <label for="description">{% trans "Description" %}</label>
                                </div>
                                <div>
                                    <textarea class="w3-padding w3-round-large box_container_input h-100px" id="description" name="description"
                                        placeholder="{% trans 'Enter offer description here...' %}"></textarea>
                                    <span class="error-message hidden text-85080c"><small></small></span>
                                </div>
                            </div>
                        </div>

                        <div class="input-section">
                            <!-- Category Dropdown -->
                            <div class="w3-cell box_container">
                                <div>
                                    <label for="category">{% trans "Category" %}</label>
                                </div>
                                <div>
                                    <select class="w3-padding w3-round-large box_container_input" id="category" name="category"
                                        onchange="showRelevantFields();" required>
                                        <option value="common">{% trans "Common Promotion" %}</option>
                                        <option value="promo_code">{% trans "Promo Code Specific" %}</option>
                                        {% comment %} <option value="targeted_offers">{% trans "Targeted Offers" %}</option>
                                        <option value="seasonal_event">{% trans "Seasonal & Special Events" %}</option>
                                        <option value="loyalty_program">{% trans "Referral & Loyalty Programs" %}</option> {% endcomment %}
                                    </select>
                                </div>
                            </div>
                    
                            <!-- dicount_percentage -->
                            <div class="w3-cell box_container">
                                <div>
                                    <label for="discount_percentage">{% trans "Discount Percentage" %}</label>
                                </div>
                                <div>
                                    <input class="w3-padding w3-round-large box_container_input" type="number" id="discount_percentage"
                                        name="discount_percentage" step="0.01" min="0"
                                        placeholder="{% trans 'Enter discount percentage' %}">
                                    <span class="error-message hidden text-85080c"><small></small></span>
                                </div>
                            </div>
                        </div>
                    
                    
                        <!-- Common Promotion Fields -->
                        <div id="common_fields" class="input-section">
                    
                            <!-- Minimum Spend -->
                            <div class="w3-cell box_container">
                                <div>
                                    <label for="minimum_spend">{% trans "Minimum Spend" %}</label>
                                </div>
                                <div>
                                    <input class="w3-padding w3-round-large box_container_input" type="number" id="minimum_spend"
                                        name="minimum_spend" step="0.01" placeholder="{% trans 'Enter minimum spend' %}">
                                    <span class="error-message hidden text-85080c"><small></small></span>
                                </div>
                            </div>
                    
                            <!-- validity_from -->
                            <div class="w3-cell box_container">
                                <div>
                                    <label for="validity_from">{% trans "Valid From" %}</label>
                                </div>
                                <div>
                                    <input class="w3-padding w3-round-large box_container_input" type="date" id="validity_from"
                                        name="validity_from">
                                    <span class="error-message hidden text-85080c"><small></small></span>
                                </div>
                            </div>
                    
                            <!-- validity_to -->
                            <div class="w3-cell box_container">
                                <div>
                                    <label for="validity_to">{% trans "Valid To" %}</label>
                                </div>
                                <div>
                                    <input class="w3-padding w3-round-large box_container_input" type="date" id="validity_to"
                                        name="validity_to">
                                    <span class="error-message hidden text-85080c"><small></small></span>
                                </div>
                            </div>
                        </div>
                    
                        <!-- Promo Code Specific Fields -->
                        <div id="promo_code_fields" class="input-section hidden">
                                <!-- promocode -->
                                <div class="w3-cell box_container">
                                    <div>
                                        <label for="promo_code">{% trans "Promo Code" %}</label>
                                    </div>
                                    <div>
                                        <input class="w3-padding w3-round-large box_container_input" type="text" id="promo_code"
                                            name="promo_code">
                                        <span class="error-message hidden text-85080c"><small></small></span>
                                    </div>
                                </div>
                    
                                <!-- max_uses -->
                                <div class="w3-cell box_container">
                                    <div>
                                        <label for="max_uses">{% trans "Max Uses" %}</label>
                                    </div>
                                    <div>
                                        <input class="w3-padding w3-round-large box_container_input" type="number" id="max_uses"
                                            name="max_uses">
                                        <span class="error-message hidden text-85080c"><small></small></span>
                                    </div>
                                </div>

                                <!-- promo_validity_from -->
                                <div class="w3-cell box_container">
                                    <div>
                                        <label for="promo_validity_from">{% trans "Valid From" %}</label>
                                    </div>
                                    <div>
                                        <input class="w3-padding w3-round-large box_container_input" type="date" id="promo_validity_from"
                                            name="promo_validity_from"><br>
                                        <span class="error-message hidden text-85080c"><small></small></span>
                                    </div>
                                </div>
                    
                                <!-- promo_validity_to -->
                                <div class="w3-cell box_container">
                                    <div>
                                        <label for="promo_validity_to">{% trans "Valid To" %}</label>
                                    </div>
                                    <div>
                                        <input class="w3-padding w3-round-large box_container_input" type="date" id="promo_validity_to"
                                            name="promo_validity_to"><br>
                                        <span class="error-message hidden text-85080c"><small></small></span>
                                    </div>
                                </div>
                        </div>
                    
                        <!-- Targeted Offers Fields -->
                        <div id="targeted_fields" class="w3-margin-top hidden">
                            <!-- Add your targeted offers fields here -->
                            <div class="w3-cell box_container">
                                <div>
                                    <label for="targeted_type">{% trans "Targeted Offer Type" %}</label>
                                </div>
                                <div>
                                    <select class="w3-padding w3-round-large box_container_input" id="targeted_type" name="targeted_type">
                                        <option value="early_bird">{% trans "Early Bird" %}</option>
                                        <option value="last_minute">{% trans "Last Minute" %}</option>
                                        <option value="family">{% trans "Family Package" %}</option>
                                        <!-- Add more options as necessary -->
                                    </select>
                                </div>
                            </div>
                        </div>
                    
                        <!-- Seasonal & Special Events Fields -->
                        <div id="seasonal_event_fields" class="w3-margin-top hidden">
                            <div class="w3-cell box_container">
                                <div>
                                    <label for="occasion_name">{% trans "Occasion Name" %}</label>
                                </div>
                                <div>
                                    <input class="w3-padding w3-round-large box_container_input" type="text" id="occasion_name"
                                        name="occasion_name">
                                    <span class="error-message hidden text-85080c"><small></small></span>
                                </div>
                            </div>
                        </div>
                    
                        <!-- Referral & Loyalty Program Fields -->
                        <div id="loyalty_program_fields" class="w3-margin-top hidden">
                            <div class="w3-cell box_container">
                                <div>
                                    <label for="points_required">{% trans "Points Required" %}</label>
                                </div>
                                <div>
                                    <input class="w3-padding w3-round-large box_container_input" type="number" id="points_required"
                                        name="points_required">
                                    <span class="error-message hidden text-85080c"><small></small></span>
                                </div>
                            </div>
                        </div>
                    
                    </div>
                    <!-- Submit Buttons -->
                    <div class="add-actions-container">
                        <button class="w3-round-large w3-margin-right btn w3-padding-large border-85080c text-85080c"
                            onclick="document.getElementById('id03').style.display='none'" type="button">{% trans "Cancel" %}</button>
                        <button class="w3-round-large activee btn w3-section w3-padding-large" type="submit" id="submitForm">{% trans "Save" %}</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="chaletData" data-chalet-id="{{ selected_chalet.id }}" class="hidden"></div>


    
    <script type="text/javascript">
        window.CSRF_TOKEN = '{{ csrf_token }}';
    </script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    {% comment %} <script src="{% static 'chalets/js/chalet_offer_promotion.js' %}"></script> {% endcomment %}
    <script>
        var chaletId = document.getElementById('chaletData').getAttribute('data-chalet-id');
        function showRelevantFields() {
            const category = document.getElementById("category").value;

            // Hide all field sections
            document.getElementById("common_fields").style.display = "none";
            document.getElementById("promo_code_fields").style.display = "none";
            document.getElementById("targeted_fields").style.display = "none";
            document.getElementById("seasonal_event_fields").style.display = "none";
            document.getElementById("loyalty_program_fields").style.display = "none";

            // Show fields based on selected category
            switch (category) {
                case "common":
                    document.getElementById("common_fields").style.display = "flex";
                    break;
                case "promo_code":
                    document.getElementById("promo_code_fields").style.display = "flex";
                    break;
                case "targeted_offers":
                    document.getElementById("targeted_fields").style.display = "block";
                    break;
                case "seasonal_event":
                    document.getElementById("seasonal_event_fields").style.display = "block";
                    break;
                case "loyalty_program":
                    document.getElementById("loyalty_program_fields").style.display = "block";
                    break;
            }
        }


        
        // Script to open and close sidebar
        function w3_open() {
        document.getElementById("mySidebar").style.display = "block";
        document.getElementById("myOverlay").style.display = "block";
        }
        
        function w3_close() {
        document.getElementById("mySidebar").style.display = "none";
        document.getElementById("myOverlay").style.display = "none";
        }
        function validateForm() {
            document.querySelectorAll('.error-message').forEach(el => {
                el.style.display = 'none';
                el.querySelector('small').innerText = '';
            });
        
            const category = document.getElementById("category").value;
        
            const offerName = document.getElementById("offer_name");
            const description = document.getElementById("description");
            const discountPercentage = document.getElementById("discount_percentage");
        
            // Offer Name Validation
            if (!offerName.value.trim()) {
                showError(offerName, "{% trans 'Offer Name is required.' %}");
                return false;
            }
        
            if (offerName.value.trim().length > 30) {
                showError(offerName, "{% trans 'Offer Name cannot exceed 30 characters.' %}");
                return false;
            }
        
            // Description Validation
            if (!description.value.trim()) {
                showError(description, "{% trans 'Description is required.' %}");
                return false;
            }
        
            if (description.value.trim().length > 100) {
                showError(description, "{% trans 'Description cannot exceed 100 characters.' %}");
                return false;
            }
        
            // Discount Validation
            if (!discountPercentage.value.trim()) {
                showError(discountPercentage, "{% trans 'You need to enter discount percentage to proceed.' %}");
                return false;
            }
        
            if (discountPercentage.value && (parseFloat(discountPercentage.value) <= 0 || parseFloat(discountPercentage.value) > 100)) {
                showError(discountPercentage, "{% trans 'Please enter a valid discount percentage (between 0 and 100).' %}");
                return false;
            }
        
            switch (category) {
                case "common":
                    // Common category validations
                    const minimumSpend = document.getElementById("minimum_spend");
                    const validityFrom = document.getElementById("validity_from");
                    const validityTo = document.getElementById("validity_to");
        
                    // Ensure minimum spend does not allow decimals
                    const minimumSpendValue = minimumSpend.value.trim();
                    if (!/^\d+$/.test(minimumSpendValue)) {
                        showError(minimumSpend, "{% trans 'Minimum spend must be a whole number (no decimals).' %}");
                        return false;
                    }
        
                    if (parseInt(minimumSpendValue) <= 0) {
                        showError(minimumSpend, "{% trans 'Please enter a valid minimum spend.' %}");
                        return false;
                    }
        
                    if (!validityFrom.value) {
                        showError(validityFrom, "{% trans 'Please specify a valid start date.' %}");
                        return false;
                    }
        
                    if (!validityTo.value) {
                        showError(validityTo, "{% trans 'Please specify a valid end date.' %}");
                        return false;
                    }
        
                    const currentDate = new Date();
                    currentDate.setHours(0, 0, 0, 0);
                    const fromDate = new Date(validityFrom.value);
                    fromDate.setHours(0, 0, 0, 0);
                    const toDate = new Date(validityTo.value);
                    toDate.setHours(0, 0, 0, 0);
        
                    if (fromDate < currentDate) {
                        showError(validityFrom, "{% trans 'Valid From date cannot be in the past.' %}");
                        return false;
                    }
                    if (toDate < currentDate) {
                        showError(validityTo, "{% trans 'Validity To date cannot be in the past.' %}");
                        return false;
                    }
                    if (fromDate > toDate) {
                        showError(validityFrom, "{% trans 'Start date cannot be later than the end date.' %}");
                        return false;
                    }
                    break;
        
                case "promo_code":
                    // Promo code validations
                    const promoCode = document.getElementById("promo_code");
                    const maxUses = document.getElementById("max_uses");
                    const promo_validity_from = document.getElementById("promo_validity_from");
                    const promo_validity_to = document.getElementById("promo_validity_to");
        
                    if (!promoCode.value.trim()) {
                        showError(promoCode, "{% trans 'Promo code is required.' %}");
                        return false;
                    }
        
                    if (promoCode.value.trim().length > 50) {
                        showError(promoCode, "{% trans 'Promo code cannot exceed 50 characters.' %}");
                        return false;
                    }
                    console.log("promocode----",promoCode.value.trim())
                    let promoCodeExists = false; 
                    var chalet_id = chaletId;
                    $.ajax({
                        url: "{% url 'chalet_promocodeunique' %}", 
                        method: 'POST',
                        async: false, 
                        data: {
                            promo_code: promoCode.value.trim(),
                            chalet_id:chalet_id,
                            csrfmiddlewaretoken: "{{ csrf_token }}"
                        },
                        success: function(response) {
                            if (response.exists) {
                                promoCodeExists = true;
                                console.log("not unique")
                                showError(promoCode, "{% trans 'Promo code already exists.' %}");
                            }
                        },
                    });

                    if (promoCodeExists) {
                        return false;
                    }
                        
        
                    var maxUsesValue = parseInt(maxUses.value, 10);
                    if (isNaN(maxUsesValue) || maxUsesValue <= 0 || maxUsesValue >= 1999999999) {
                    showError(maxUses, "{% trans 'Please specify a valid number of max uses below 1999999999.' %}");
                    return false;
                    }

                    if (!promo_validity_from.value) {
                        showError(promo_validity_from, "{% trans 'Please specify a valid date.' %}");
                        return false;
                    }

                    if (!promo_validity_to.value) {
                        showError(promo_validity_to, "{% trans 'Please specify a valid date.' %}");
                        return false;
                    } 
                    const promocurrentDate = new Date();
                    promocurrentDate.setHours(0, 0, 0, 0);
                    const promofromDate = new Date(promo_validity_from.value);
                    promofromDate.setHours(0, 0, 0, 0);
                    const promotoDate = new Date(promo_validity_to.value);
                    promotoDate.setHours(0, 0, 0, 0);
                    if (promofromDate < promocurrentDate) {
                        showError(promo_validity_from, "{% trans 'Valid From date cannot be in the past.' %}");
                        return false;
                    }
                    if (promotoDate < promocurrentDate) {
                        showError(promo_validity_to, "{% trans 'Validity To date cannot be in the past.' %}");
                        return false;
                    }

                    if (new Date(promo_validity_from.value) > new Date(promo_validity_to.value)) {
                        showError(promo_validity_from, "{% trans 'Start date cannot be later than end date.' %}");
                        return false;
                    }
                    break;
        
                case "targeted_offers":
                    const targetedType = document.getElementById("targeted_type");
                    if (!targetedType.value) {
                        showError(targetedType, "{% trans 'Please select a targeted offer type.' %}");
                        return false;
                    }
                    break;
        
                case "seasonal_event":
                    const occasionName = document.getElementById("occasion_name");
        
                    if (!occasionName.value.trim()) {
                        showError(occasionName, "{% trans 'Occasion name is required.' %}");
                        return false;
                    }
        
                    if (!isNaN(occasionName.value.trim())) {
                        showError(occasionName, "{% trans 'Occasion name cannot be a number.' %}");
                        return false;
                    }
        
                    if (occasionName.value.trim().length > 100) {
                        showError(occasionName, "{% trans 'Occasion name cannot exceed 100 characters.' %}");
                        return false;
                    }
                    break;
        
                case "loyalty_program":
                    const pointsRequired = document.getElementById("points_required");
        
                    const pointsRequiredValue = parseInt(pointsRequired.value);
                    if (isNaN(pointsRequiredValue) || pointsRequiredValue <= 0) {
                        showError(pointsRequired, "{% trans 'Please specify the points required.' %}");
                        return false;
                    }
                    break;
            }
        
            return true;
        }
        

        function showError(inputElement, message) {
            const errorSpan = inputElement.parentNode.querySelector('.error-message');
        
            if (errorSpan) {
                errorSpan.style.display = 'block';
                errorSpan.querySelector('small').innerText = message;
                }
            }

            function reloadcreate() {
                var discount = document.getElementById("category").value;
                var page =   1;
                var chalet_id = chaletId;
                $('#select_discount').val(discount);
                $('.loader').css('display','flex');
                $('#hotelTable').addClass('blurred');
                setTimeout(function() {
                    $.ajax({
                    url: '/chalets/chalet_offers/filter/',
                    type: 'GET',
                    headers: {
                        'X-CSRFToken': window.CSRF_TOKEN
                    },
                    data: {
                        "chalet_id": chalet_id,
                        "discount": discount,
                        "page": page
                    },
                    success: function (data) {
                        $('#chaletuserOfferForm')[0].reset();
                        $("#category").trigger("change"); 
                        $('#hotelTable').removeClass('blurred');
                        $('.loader').hide();
                        $('table thead').html($(data).find('thead').html());
                        $('table tbody').html($(data).find('tbody').html());
                        $('#pagination-container').html($(data).find('#pagination-container').html());
                        const rows = $(data).find('table tbody tr');
                        const totalRows = rows.length;
           
                        const currentPage = parseInt($('.current-page').text(), 15) || 1;
           
                        if ((totalRows === 1 && rows.find('td[colspan]').length > 0) || (currentPage === 1 && totalRows < 15)) {
                            $('#pagination-container').hide();
                        } else {
                            $('#pagination-container').show();
                        }     
                    },
                    error: function (xhr, status, error) {
                        console.error('Error fetching data:', error);
                        alert("{% trans 'Error fetching pagination data. Please try again later.' %}");
           
                        $('.loader').hide();
                        $('#hotelTable').removeClass('blurred');
                    }
                });
                }, 500); 
            }
            
            $('#chaletuserOfferForm').on('submit', function (e) {
            e.preventDefault();  
           
            if (!validateForm()) {
                return;  
            }
           
            var form = $(this);
            var formData = form.serialize();  
           
            $('.loader').css('display','flex');
            $('#hotelTable').addClass('blurred');
           
            $.ajax({
                url: form.attr('action'),
                type: 'POST',
                headers: {
                    'X-CSRFToken': window.CSRF_TOKEN
                },
                data: formData,  
                success: function (data) {
                    $('.loader').hide();
                    $('#hotelTable').removeClass('blurred');
                    reloadcreate();
                    document.getElementById('id03').style.display = 'none';
                    $('#chaletuserOfferForm')[0].reset();
            
                },
                error: function (xhr, status, error) {
                    console.error('Error submitting form:', error);
                    alert("{% trans 'Error submitting the form. Please try again later.' %}");
           
                    $('.loader').hide();
                    $('#hotelTable').removeClass('blurred');
                    document.getElementById('id03').style.display = 'none';
           
                }
            });
           });
       
        document.addEventListener('DOMContentLoaded', function () {
            var openModalButton = document.getElementById('openModalButton');
            var modal = document.getElementById('id03');

            openModalButton.addEventListener('click', function () {
                modal.style.display = 'flex';
            });

            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            }
        });

        function reload() {
            var discount = $('.select_discount').val();
            var page =  parseInt($('.current-page').text(), 10) || 1;
            var chalet_id = chaletId;

            $('.loader').css('display','flex');
            $('#hotelTable').addClass('blurred');
            
            setTimeout(function() {
                $.ajax({
                url: '/chalets/chalet_offers/filter/',
                type: 'GET',
                headers: {
                    'X-CSRFToken': window.CSRF_TOKEN
                },
                data: {
                    "chalet_id": chalet_id,
                    "discount": discount,
                    "page": page
                },
                success: function (data) {
                    $('#hotelTable').removeClass('blurred');
                    $('.loader').hide();
                    $('table thead').html($(data).find('thead').html());
                    $('table tbody').html($(data).find('tbody').html());
                    $('#pagination-container').html($(data).find('#pagination-container').html());
                    const rows = $(data).find('table tbody tr');
                    const totalRows = rows.length;
       
                    const currentPage = parseInt($('.current-page').text(), 15) || 1;
       
                    if ((totalRows === 1 && rows.find('td[colspan]').length > 0) || (currentPage === 1 && totalRows < 15)) {
                        $('#pagination-container').hide();
                    } else {
                        $('#pagination-container').show();
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching data:', error);
                    alert("{% trans 'Error fetching pagination data. Please try again later.' %}");
       
                    $('.loader').hide();
                    $('#hotelTable').removeClass('blurred');
                }
            });
            }, 500); 
        }


        $(document).ready(function() {
            $('table').on('click', '.edit-offer', function(e) {
                e.preventDefault();

                var offerId = $(this).data('offer-id');
                var chalet_id = chaletId;

                $.ajax({
                    url: '/chalets/chalet_offers/' + offerId + '/' + chalet_id +'/',
                    type: 'GET',
                    success: function(data) {
                        $('#offer_id').val(offerId)
                        $('#offer_name_edit').val(data.offer_name);
                        $('#description_edit').val(data.description);
                        $('#discount_percentage_edit').val(data.discount_percentage);
                        $('#minimum_spend_edit').val(data.minimum_spend);
                        $('#validity_from_edit').val(data.validity_from);
                        $('#promo_validity_from_edit').val(data.validity_from);
                        $('#promo_validity_to_edit').val(data.validity_to);
                        $('#validity_to_edit').val(data.validity_to);
                        $('#promo_code_edit').val(data.promo_code);
                        $('#previous_promo_code').val(data.promo_code);
                        $('#max_uses_edit').val(data.max_uses);
                        $('#targeted_type_edit').val(data.targeted_offer_type);
                        $('#occasion_name_edit').val(data.occasion_name);
                        $('#points_required_edit').val(data.points_required);
                        setCategoryField(data.category);
                        
                        $('#id02').css('display','flex') 
                        showRelevantFieldsEdit(data.category);
                    },
                    error: function(xhr, status, error) {
                        console.error('Error fetching offer data:', error);
                    }
                });
            });

            const categoryMapping = {
                "common": "Common",
                "promo_code": "Promo Code Specific",
                "targeted_offers": "Targeted Offers",
                "seasonal_event": "Seasonal Event",
                "loyalty_program": "Loyalty Program"
            };

            function setCategoryField(categoryValue) {
                const userFriendlyCategory = categoryMapping[categoryValue] || categoryValue;
                $('#category_edit').val(userFriendlyCategory);
            }

            function getCategoryKey(userFriendlyCategory) {
                return Object.keys(categoryMapping).find(key => categoryMapping[key] === userFriendlyCategory) || userFriendlyCategory;
            }

            function showRelevantFieldsEdit(category) {
                $('#mandotory_edit').hide();
                $('#promo_code_fields_edit').hide();
                $('#common_fields_edit').hide();
                $('#targeted_fields_edit').hide();
                $('#seasonal_event_fields_edit').hide();
                $('#loyalty_program_fields_edit').hide();

                switch (category) {
                    case "common":
                        $('#mandotory_edit').css('display','flex');
                        $('#common_fields_edit').css('display','flex');
                        break;
                    case "promo_code":
                        $('#mandotory_edit').css('display','flex');
                        $('#promo_code_fields_edit').css('display','flex');
                        break;
                    case "targeted_offers":
                        $('#mandotory_edit').show();
                        $('#targeted_fields_edit').show();
                        break;
                    case "seasonal_event":
                        $('#mandotory_edit').show();
                        $('#seasonal_event_fields_edit').show();
                        break;
                    case "loyalty_program":
                        $('#mandotory_edit').show();
                        $('#loyalty_program_fields_edit').show();
                        break;
                }
            }

            $('#saveEditedOfferBtn').click(function(e) {
                e.preventDefault();
                var offerId = $('#offer_id').val();
                var chalet_id = chaletId;

                var userFriendlyCategory = $('#category_edit').val();
                var category = getCategoryKey(userFriendlyCategory);
                var isValid = true;
                $('.error-message_edit').hide(); 

                function showError(element, message) {
                    const errorSpan = $(element).closest('.box_container').find('.error-message_edit');

                    errorSpan.find('small').text(message).show();
                    
                    errorSpan.show();
                    element.focus();
                    isValid = false;
                }
                
                
                const offerName = $("#offer_name_edit");
                const description = $("#description_edit");
                const discountPercentage = $("#discount_percentage_edit");

                if (!offerName.val().trim()) {
                    showError(offerName, "{% trans 'Offer Name is required.' %}");
                    return false;
                }
                if (offerName.val().trim().length > 30) {
                    showError(offerName, "{% trans 'Offer Name cannot exceed 30 characters.' %}");
                    return false;
                }

                if (!description.val().trim()) {
                    showError(description, "{% trans 'Description is required.' %}");
                    return false;
                }
                if (description.val().trim().length > 100) {
                    showError(description, "{% trans 'Description cannot exceed 100 characters.' %}");
                    return false;
                }

                if (!discountPercentage.val().trim()) {
                    showError(discountPercentage, "{% trans 'You need to enter discount percentage to proceed.' %}");
                    return false;
                }

                if (discountPercentage.val() && (discountPercentage.val() <= 0 || discountPercentage.val() > 100)) {
                    showError(discountPercentage, "{% trans 'Please enter a valid discount percentage (between 0 and 100).' %}");
                    return false;
                } 
                
                switch (category) {
                    case "common":
                        const minimumSpend = $('#minimum_spend_edit');
                        const validityFrom = $('#validity_from_edit');
                        const validityTo = $('#validity_to_edit');
                        console.log("condition check")

                        if (!minimumSpend.val()) {
                            showError(minimumSpend, "{% trans 'Minimum spend is required.' %}");
                        } else if (!/^\d+$/.test(minimumSpend.val())) {
                            showError(minimumSpend, "{% trans 'Minimum spend must be a whole number without decimal points.' %}");
                        } else if (parseInt(minimumSpend.val()) <= 0) {
                            showError(minimumSpend, "{% trans 'Please enter a valid minimum spend greater than zero.' %}");
                        }
                        

                        if (!validityFrom.val()) {
                            showError(validityFrom, "{% trans 'Please specify a valid date.' %}");
                        }

                        if (!validityTo.val()) {
                            showError(validityTo, "{% trans 'Please specify a valid date.' %}");
                        }

                        const currentDate = new Date();
                        currentDate.setHours(0, 0, 0, 0);
                        const fromDate = new Date(validityFrom.val());
                        fromDate.setHours(0, 0, 0, 0);
                        const toDate = new Date(validityTo.val());
                        toDate.setHours(0, 0, 0, 0);
                        

                        if (fromDate < currentDate) {
                            showError(validityFrom, "{% trans 'Valid From date cannot be in the past.' %}");
                        }
                        if (toDate < currentDate) {
                            showError(validityTo, "{% trans 'Validity To date cannot be in the past.' %}");
                        }
                        if (fromDate > toDate) {
                            showError(validityFrom, "{% trans 'Start date cannot be later than end date.' %}");
                        }
                        break;

                    case "promo_code":
                        const promoCode = $('#promo_code_edit');
                        const maxUses = $('#max_uses_edit');
                        const promo_validity_from_edit = document.getElementById("promo_validity_from_edit");
                        const promo_validity_to_edit = document.getElementById("promo_validity_to_edit");

                        if (!promoCode.val().trim()) {
                            showError(promoCode, "{% trans 'Promo code is required.' %}");
                        }

                        var previous_promo_code = document.getElementById('previous_promo_code')
                        var chalet_id = chaletId;

                        if (previous_promo_code.value !== promoCode.val().trim()){
                            let promoCodeExists = false; 
                            $.ajax({
                                url: "{% url 'chalet_promocodeunique' %}", 
                                method: 'POST',
                                async: false, 
                                data: {
                                    promo_code: promoCode.val().trim(),
                                    chalet_id:chalet_id,
                                    csrfmiddlewaretoken: "{{ csrf_token }}"
                                },
                                success: function(response) {
                                    if (response.exists) {
                                        promoCodeExists = true;
                                        showError(promoCode, "{% trans 'Promo code already exists.' %}");
                                    }
                                },
                            });

                            if (promoCodeExists) {
                                return false;
                            }
                        }
                        
                        var maxUsesValue = parseInt(maxUses.val(), 10);
                        if (isNaN(maxUsesValue) || maxUsesValue <= 0 || maxUses.val() >= 1999999999) {
                            showError(maxUses, "{% trans 'Please specify a valid number of max uses below 1999999999.' %}");
                            return false;
                        }
                        if (!promo_validity_from_edit.value) {
                            showError(promo_validity_from_edit, "{% trans 'Please specify a valid date.' %}");
                            return false;
                        }
    
                        if (!promo_validity_to_edit.value) {
                            showError(promo_validity_to_edit, "{% trans 'Please specify a valid date.' %}");
                            return false;
                        } 
                        const promocurrentDateedit = new Date();
                        promocurrentDateedit.setHours(0, 0, 0, 0);
                        const promofromDateedit = new Date(promo_validity_from_edit.value);
                        promofromDateedit.setHours(0, 0, 0, 0);
                        const promotoDateedit = new Date(promo_validity_to_edit.value);
                        promotoDateedit.setHours(0, 0, 0, 0);
                        if (promofromDateedit < promocurrentDateedit) {
                            showError(promo_validity_from_edit, "{% trans 'Valid From date cannot be in the past.' %}");
                            return false;
                        }
                        if (promotoDateedit < promocurrentDateedit) {
                            showError(promo_validity_to_edit, "{% trans 'Validity To date cannot be in the past.' %}");
                            return false;
                        }
    
                        if (new Date(promo_validity_from_edit.value) > new Date(promo_validity_to_edit.value)) {
                            showError(promo_validity_from_edit, "{% trans 'Start date cannot be later than end date.' %}");
                            return false;
                        }
                        break;

                    case "targeted_offers":
                        const targetedType = $('#targeted_type_edit');

                        if (!targetedType.val()) {
                            showError(targetedType, "{% trans 'Please select a targeted offer type.' %}");
                        }
                        break;

                    case "seasonal_event":
                        const occasionName = $('#occasion_name_edit');

                        if (!occasionName.val().trim()) {
                            showError(occasionName, "{% trans 'Occasion name is required.' %}");
                        }

                        if (!isNaN(occasionName.val().trim())) {
                            showError(occasionName, "{% trans 'Occasion name cannot be a number.' %}");
                        }
                        break;

                    case "loyalty_program":
                        const pointsRequired = $('#points_required_edit');

                        if (!pointsRequired.val() || pointsRequired.val() <= 0) {
                            showError(pointsRequired, "{% trans 'Please specify the points required.' %}");
                        }
                        break;
                }

                if (isValid) {
                    const offerData = {  
                        offer_name: $('#offer_name_edit').val(),
                        description: $('#description_edit').val(),
                        category: category,
                        discount_percentage: $('#discount_percentage_edit').val(),
                        minimum_spend: $('#minimum_spend_edit').val(),
                        validity_from: $('#validity_from_edit').val(),
                        validity_to: $('#validity_to_edit').val(),
                        promo_code: $('#promo_code_edit').val(),
                        max_uses: $('#max_uses_edit').val(),
                        promo_validity_from: $('#promo_validity_from_edit').val(),
                        promo_validity_to: $('#promo_validity_to_edit').val(),
                        targeted_type: $('#targeted_type_edit').val(),
                        occasion_name: $('#occasion_name_edit').val(),
                        points_required: $('#points_required_edit').val()
                    };

                    $.ajax({
                        url: '/chalets/chalet_offers/' + offerId + '/' + chalet_id +'/',
                        type: 'POST', 
                        headers: {
                            'X-CSRFToken': window.CSRF_TOKEN
                        },
                        data: offerData,
                        success: function(data) {
                            $('#id02').hide(); 
                            reload(); 
                        },
                        error: function(xhr, status, error) {
                            console.error('Error updating offer:', error);
                            alert("{% trans 'Error updating offer. Please try again later.' %}");
                        }
                    });
                }
            });
        });



        $(document).ready(function() {
            $('table').on('click', '.delete-offer', function(e) {
                e.preventDefault();
                
                var offerId = $(this).data('delete-id');
                var chalet_id = chaletId;
                
                if (confirm("{% trans 'Are you sure you want to delete this offer?' %}")) {
                    $.ajax({
                        url: '/chalets/chalet_offers/delete/' + offerId + '/'+ chalet_id +'/',
                        type: 'DELETE',
                        headers: {
                            'X-CSRFToken': window.CSRF_TOKEN
                        },
                        success: function(data) {
                            $(e.target).closest('tr').remove();
                            reload();
                        },
                        error: function(xhr, status, error) {
                            console.error('Error deleting offer:', error);
                            alert("{% trans 'Error deleting offer. Please try again later.' %}");
                        }
                    });
                }
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
            flatpickr("#datePicker", {
                enableTime: false,  
                dateFormat: "Y-m-d"

            });
            flatpickr("#datePicker1", {
                enableTime: false,  
                dateFormat: "Y-m-d"

            });
        });
        
        function resetDate(dateId) {
            document.getElementById(dateId).value = '';
        }

        $(document).ready(function(){
            $('.search_button').click(function(event){
                event.preventDefault();
                $('.loader').css('display','flex');
                $('#hotelTable').addClass('blurred');

                var loaderTimeout = setTimeout(function() {
                    $('.loader').hide();
                    $('#hotelTable').removeClass('blurred');
                }, 1000);
                
                var chalet_id = {{ selected_chalet.id }};
                var discount = $('.select_discount').val();
                var page = $(this).data('page');
               
                setTimeout(function() {
                    $.ajax({
                        url:'{%url "chalet_offer_filter" %}',
                        type:'POST',
                        headers: {
                            'X-CSRFToken': window.CSRF_TOKEN
                        },
                        data:{
                            
                            "chalet_id": chalet_id,
                            "discount": discount ,
                            "page":page
                        
                        
                        },
                        success:function(data){
                            $('table thead').html($(data).find('thead').html());
                            $('table tbody').html($(data).find('tbody').html());
                            $('#pagination-container').html($(data).find('#pagination-container').html());
                            const rows = $(data).find('table tbody tr');
                            const totalRows = rows.length;

                            const currentPage = parseInt($('.current-page').text(), 15) || 1;

                            if ((totalRows === 1 && rows.find('td[colspan]').length > 0) || (currentPage === 1 && totalRows < 15)) {
                                $('#pagination-container').hide();
                            } else {
                                $('#pagination-container').show();
                            }   

                        },
                        error:function(xhr,status,error){
                            console.error('error :',error);
                        }
                    });
                }, 500);      
            })    
        });
        $(document).ready(function () {
            $(document).on('click', '.pagination-link', function (e) {
                e.preventDefault(); // Prevent default anchor behavior
           
                $('.loader').css('display','flex');
                $('#hotelTable').addClass('blurred');
                var chalet_id = chaletId;
                var discount = $('.select_discount').val();
                var page = $(this).data('page');
           
                $.ajax({
                    url: '/chalets/chalet_offers/filter/',
                    type: 'GET',
                    headers: {
                        'X-CSRFToken': window.CSRF_TOKEN
                    },
                    data: {
                        "chalet_id": chalet_id,
                        "discount": discount,
                        "page": page
                    },
                    success: function (data) {
                        $('#hotelTable').removeClass('blurred');
                        $('.loader').hide();
                        $('table thead').html($(data).find('thead').html());
                        $('table tbody').html($(data).find('tbody').html());
                        $('#pagination-container').html($(data).find('#pagination-container').html());
                        const rows = $(data).find('table tbody tr');
                        const totalRows = rows.length;
           
                        const currentPage = parseInt($('.current-page').text(), 15) || 1;
           
                        if ((totalRows === 1 && rows.find('td[colspan]').length > 0) || (currentPage === 1 && totalRows < 15)) {
                            $('#pagination-container').hide();
                        } else {
                            $('#pagination-container').show();
                        }   
                        
                    },
                    error: function (xhr, status, error) {
                        console.error('Error fetching data:', error);
                        alert("{% trans 'Error fetching data. Please try again later.' %}");
           
                        $('.loader').hide();
                        $('#hotelTable').removeClass('blurred');
                    }
                });
            });
           });
           function updatePagination(data) {
                const rows = $(data).find('table tbody tr');
                const totalRows = rows.length;
           
                const currentPage = parseInt($('.current-page').text(), 15) || 1;
           
                if ((totalRows === 1 && rows.find('td[colspan]').length > 0) || (currentPage === 1 && totalRows < 15)) {
                    $('#pagination-container').hide();
                } else {
                    $('#pagination-container').show();
                }         
            }
           
            $(document).ready(function () {
                updatePagination(document);
                // var chalet_id = {{ selected_chalet.id }};
                $.ajax({
                    url: '/chalets/chalet_offers/',
                    method: 'GET',
                    data: {
                        "chalet_id": chaletId ,
                    },
                    success: function (data) {
                        $('table tbody').html($(data).find('table tbody').html());
                        updatePagination(data);
                    }
                });
            });
    </script>
    
</body>
</html>