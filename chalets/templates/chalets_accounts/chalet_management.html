{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="{{ request.LANGUAGE_CODE }}"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins">
    <link rel="stylesheet" href="{% static 'chalets/css/chalet-management.css' %}">
    <link rel="icon" type="image/x-icon" href="{% static 'icons/1929_dev_fevicon2.jpg' %}">
    <link rel="stylesheet" href="{% static 'css/view-edit-btn.css' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://kit.fontawesome.com/6c3486d068.js" crossorigin="anonymous"></script>
    <!-- Include Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <!-- Include Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="{% static 'css/fontstyle.css' %}">
   <!-- Toastify CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
<!-- Toastify JS -->
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script type="text/javascript">
        window.CSRF_TOKEN = '{{ csrf_token }}';
    </script>
</head>
<body>
    <!-- Sidebar/menu -->
    {% include 'chalets_accounts/chalat_logo.html' %}
    {% include 'accounts/search_navbar.html' %} 
    
    </div>
    <div id="loader" style="display: none;"></div>

    <div class="w3-overlay w3-hide-large cursor-pointer" onclick="w3_close()" title="close side menu" id="myOverlay"></div>
        <div class="w3-main main-section">
                <div class="container container-box w-full">
                    <div class="row justify-content-center">
                        <div class="row" >
                            <div class="col-md-4">
                                <button class="btn btn-red px-3 available_button activee" type="button" id="available_btn">
                                    {% trans "Available Chalet" %}
                                </button>
                            </div>    
                        
                            <div class="col-md-4">
                                <button class="btn btn-red px-3 booked_button" type="button" id="booked_btn">
                                    {% trans "Booked Chalet" %}
                                </button>
                            </div>                          
                        </div>          
                        <br>
                        <div class="row-main" id="hotelTable">
                            <div class="row ">
                                <!-- <div class="col-md-4">
                                        <select aria-label="Default select example" class="form-select select_roomtype fs12 text-black white" style="outline: none;">
                                            <option value="">{% trans "Property Type" %}</option>
                                                {%for type in property_type%}
                                                    <option value="{{type}}">{{type|capfirst}}</option>
                                                {%endfor%}
                                        </select>
                                </div>
                                <div class="col-md-4">
                                    <button class=" btn-blue search_button" type="button">
                                        <i class="fa-solid fa-magnifying-glass"></i>{% trans "Search" %} 
                                    </button>
                                </div> -->


                                <div class="col-md-4 ">
                                    <a href="{% url 'add_chalet' %}?chalet_id={{selected_chalet.id}}"   id="add_button" class="btn textdecoration-none rounded-32px bg-85080c text-white"> {% trans "Add Chalet" %}</a> 
                                    <div id="id01" class="w3-modal">
                                        <div class="w3-modal-content add-room w3-card-4 w3-round-xlarge max-w-90per">
                                    
                                          <div class="w3-center"><br>
                                            <span onclick="document.getElementById('id01').style.display='none'" class="w3-button w3-xlarge w3-hover-red w3-display-topright" title="Close Modal">&times;</span>
                                            
                                           </div>
                                          
                                            <div class="w3-margin-left">
                                                <div>
                                                    <h3 class="w3-margin"> <i class="fa-solid fa-pen"></i>{% trans "ADD" %}  </h3>
                                                </div>
                                                <form class="w3-container " class="myform" action="{% url 'room_add' %}" method="post" enctype="multipart/form-data">
                                                    {%csrf_token%}
                                                    <div class="w3-section w3-margin-left">
                                                          <div class="w3-cell box_container">
                                                              <div>
                                                                  <label for="roomtypes">{% trans "property Type" %}</label>
                                                              </div>
                                                              <div>
                                                                 
                                                                  <select class=" form-control w3-padding w3-round-large box_container_input" id="roomtypes" name ="roomtypes" >
                                                                      
                                                                    <option value="">{% trans "Select a property type" %}</option>
                                                                    {% for type in property_type %}
                                                                        <option value="{{ type }}">{{ type|capfirst }}</option>
                                                                    {% endfor %}
                                                                      
                                                                  </select> 
                                                              </div>
                                                              <div>
                                                                <span id="roomtypes_error" class="error-message"></span>
                                                            </div>
                                                          </div>
                                                          <div class="w3-cell box_container">
                                                              <div>
                                                                  <label for="room_number">{% trans "Room Number" %}</label>
                                                              </div>
                                                              <div>
                                                                  <input class=" w3-padding  w3-round-large box_container_input" type="text" id="room_number"  name="room_number" placeholder="Please enter a room number" required> 
                                                              </div>
                                                              <div>
                                                                  <span id="room_number_error" class="error-message"></span>
                                                              </div>
                                                          </div>
                                                          
                                                          <div class="w3-cell box_container">
                                                              <div>
                                                                  <label for="total_occupency">{% trans "Occupancy" %}</label>
                                                              </div>
                                                              <div>
                                                                  <select class=" form-control w3-padding w3-round-large box_container_input" id="total_occupency" name ="total_occupency" required>
                                                                    <option>Please Select Any</option>
                                                                    <option>2</option>
                                                                    <option>3</option>
                                                                    <option>4</option>
                                                                  </select> 
                                                              </div>
                                                              <div>
                                                                <span id="occupancy_error" class="error-message"></span>
                                                            </div>
                                                          </div>
                                                          <div class="w3-margin-top ">
                                                              <div class="w3-cell box_container">
                                                                  <div>
                                                                      <label for="pice_per_night">{% trans "Price-per night" %}</label>
                                                                  </div>
                                                                  <div>
                                                                      <input class=" w3-padding  w3-round-large box_container_input " type="text" id="pice_per_night" name="pice_per_night" placeholder="Please enter a price" required> 
                                                                  </div>
                                                                  <div>
                                                                      <span id="pice_per_night_error" class="error-message"></span>
                                                                  </div>
                                                              </div>
                                                              
                                                              <div class="w3-cell box_container">
                                                                  <div>
                                                                      <label for="amenities">{% trans "Amenities" %}</label>
                                                                  </div>
                                                                  
                                                                  <div class="input-group">
                                                                      <input type="text" readonly id="amenities" class="form-control dropdown-toggle w3-padding  w3-round-large box_container_input" placeholder="Select Amenities" data-bs-toggle="dropdown" aria-expanded="false">
                                                                      <ul class="dropdown-menu dropdown-menu-end" id="amenitiesDropdown" aria-labelledby="amenitiesInput">
                                                                          {% for amenity in amenities %}
                                                                          <li>
                                                                              <label class="dropdown-item">
                                                                                  <input name="amenities" type="checkbox" value="{{ amenity.amenity_name }}" class="amenities_checkbox "> {{ amenity.amenity_name }}
                                                                              </label>
                                                                          </li>
                                                                          {% endfor %}
                                                                      </ul>
                                                                  </div>
                                                                  
                                                              </div>

                                                          <div class="w3-cell box_container">
                                                              <div class="add-images ">
                                                                  <label>{% trans "Add Images" %}</label>
                                                                  <div class="image-placeholder">
                                                                  <img src="{% static 'images/teenyicons_image-solid.png' %}" id="upload-icon" alt="Upload Icon" class="cursor-pointer">
                                                                      <input class="h-0 w-1/2 opacity-0 absolute" type="file" id="standard_images-add" name="standard_images-add" multiple>
                                                                  </div>
                                                              </div>
                                                              <div id="upload-message-add" class="text-green"></div> 
                                                              <div id="image-add-errorr" class="text-red"></div>

                                                          </div>
                                                      </div>
                                                          <div class="w3-center w3-container">
                                                              <button class="w3-button w3-round-large w3-margin-right  btn  w3-padding-large border-85080c text-85080c" onclick="document.getElementById('id01').style.display='none'"  type="button" id="cancel_button">{% trans "Cancel" %}</button>
                                                              <button class=" w3-round-large btn w3-section w3-padding-large bg-85080c text-white" type="submit" onclick="validateAndConfirm(event);">{% trans "Add" %}</button>
                                                          </div>
                                                    </div>
                                                  </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>

                            <div class="col-md-12">
                                <div class="table-container w-full">
                                    <table class="w3-table responsive-table w-full">
                                        <thead class="bg-table-head">
                                            <tr>
                                                <th class="border-right">{% trans "Sl. No." %}</th>
                                                <th class="border-right">{% trans "Chalet Name" %}</th>
                                                <th class="border-right">{% trans "No. Of Guests" %}</th>
                                                <th class="border-right">{% trans "Price" %}</th>
                                                <!-- <th class="border-right">{% trans "Weekend Price" %}</th> Added Weekend Price Column -->
                                                <th class="border-right">{% trans "Commission Amount" %}</th>
                                                <th colspan="3">{% trans "Action" %}</th>
                                            </tr>
                                        </thead>
                                        <tbody class="fs12 table-body-color table_body">
                                            {% if room_data %}
                                                {% for room in room_data %}
                                                    <tr>
                                                        <td class="border-right">{{ forloop.counter }}</td>
                                                        <td class="border-right data_roomnumber">
                                                                {{ room.name }}
                                                                </td>
                                                        <td class="border-right data_occupancy">{{ room.number_of_guests|default:"Not available" }}</td>
                                                        <td class="border-right">{{ room.price_per_night|default:"Not available" }}</td>
                                                        <!-- <td class="border-right">
                                                            {{ room.weekend_price.weekend_price|default:"Not specified" }} -->
                                                        <td class="border-right">{{ room.commission_amount|default:"Not available" }}</td>
                                    
                                                        {% if is_available_view %}
                                                            <td class="color-grey">
                                                                <div class="table-action-btn-container">
                                                                    <a href="{% url 'view_chalet' room.id %}" class="textdecoration-none view-btn" title="{% trans 'View chalet' %}">{% trans "View" %}</a>
                                                                    
                                                                
                                                                    <a href="#" data-room_id="{{room.id}}" onclick="fetch_data(this.getAttribute('data-room_id')); document.getElementById('id02').style.display='flex';" class="textdecoration-none edit-btn" title="{% trans 'Edit chalet' %}">
                                                                        <i class="fa-solid fa-pen"></i> {% trans "Edit" %} <!-- Added Edit Option -->
                                                                    </a>
                                                                </div>
                                                            </td>
                                                        {% endif %}
                                                    </tr>
                                                {% endfor %}
                                            {% else %}
                                                <tr>
                                                    <td colspan="8" class="text-center">{% trans "No data found" %}</td>
                                                </tr>
                                            {% endif %}
                                        </tbody>
                                    </table>
                                    
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- edit modal -->

                <div id="id02" class="edit-modal-container">
                    <div class="edit-modal-content">
                      <div class="modal-header">
                        <h3 class="w3-margin"> <i class="fa-solid fa-pen"></i> {% trans "Edit" %} </h3>
                        <span onclick="document.getElementById('id02').style.display='none'" class="w3-button w3-xlarge w3-hover-red w3-display-topright" title="Close Modal">&times;</span>
                       </div>
                        <div class="form-container">
                            <form class="w3-container " id="room_form" action="" method="post" enctype="multipart/form-data">
                                <input type="hidden" id="original_room_number" name="original_room_number">
                                <input type="hidden" name="chalet_id" value="{{ selected_chalet.id }}">
                                {%csrf_token%}
                                <div class="inputs-container">
                                    <div class="input-field">
                                        <div class="w3-cell box_container">
                                            <div>
                                                <label for="pice_per_night">{% trans "Price" %}</label>
                                            </div>
                                            <div>
                                                <input class=" w3-padding  w3-round-large box_container_input " type="text" id="pice_per_night1"
                                                    name="price_per_night" value="{{selected_chalet.total_price}}"
                                                    placeholder="{% trans 'Enter price' %}" required>
                                            </div>
                                            <div>
                                                <span id="pice_per_night_error1" class="error-message"></span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="input-field">
                                        <div class="w3-cell box_container">
                                            <div>
                                                <label for="weekend_price">{% trans "Weekend price (Optional)" %}</label>
                                            </div>
                                            <div>
                                                <input class=" w3-padding  w3-round-large box_container_input " type="text" id="weekend_price"
                                                    name="weekend_price" value="{{selected_chalet.weekend_price.weekend_price}}"
                                                    placeholder="{% trans 'Enter weekend price' %}">
                                            </div>
                                            <div>
                                                <span id="weekend_price_error" class="error-message"></span>
                                            </div>
                                        </div>
                                    </div>
                                                              
                                    <div class="input-field">
                                        <div class="box_container">
                                            <div>
                                                <label for="amenities">{% trans "Amenities" %}</label>
                                            </div>
                                            <div class="input-group">
                                                <input type="text" readonly id="amenitiesedit"
                                                    class="form-control dropdown-toggle w3-padding  w3-round-large box_container_input"
                                                    placeholder="{% trans 'Select Amenities' %}" data-bs-toggle="dropdown" aria-expanded="false">
                                                <ul class="dropdown-menu dropdown-menu-end" id="amenitiesDropdownedit" aria-labelledby="amenitiesInput">
                                                    {% for amenity in amenities %}
                                                    <li>
                                                        <label class="dropdown-item">
                                                            <input name="amenitiesedit" type="checkbox" value="{{ amenity.amenity_name }}"
                                                                class="amenities_checkbox ">
                                                            <span>
                                                                {% if request.LANGUAGE_CODE == 'en' %}
                                                                {{ amenity.amenity_name|title }}
                                                                {% elif request.LANGUAGE_CODE == 'ar' %}
                                                                {% if amenity.amenity_name_arabic %}
                                                                {{ amenity.amenity_name_arabic|title }}
                                                                {% else %}
                                                                {{ amenity.amenity_name|title }}
                                                                {% endif %}
                                                                {% endif %}
                                                            </span>
                                                        </label>
                                                    </li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                
                                    <div class="input-field">
                                        <div class="add-images hidden">
                                            <label>{% trans "Add Images" %}</label>
                                            <div class="image-placeholder">
                                                <img src="{% static 'images/teenyicons_image-solid.png' %}" id="upload-icon-edit" alt="Upload Icon"
                                                    class="cursor-pointer">
                                                <input class="absolute opacity-0 cursor-pointer w-1/2 h-0" type="file" id="standard_images-edit"
                                                    name="standard_images-edit" multiple>
                                            </div>
                                        </div>
                                        <div id="upload-message-edit" class="text-green"></div>
                                        <div id="image-edit-errorr" class="text-red"></div>
                                    </div>
                                </div>
                                <div class="w3-center w3-container">
                                    <button class="w3-button w3-round-large w3-margin-right  btn  w3-padding-large border-85080c text-85080c" onclick="document.getElementById('id02').style.display='none'" type="button" >{% trans "Cancel" %}</button>
                                    <button class=" w3-round-large btn w3-section w3-padding-large bg-85080c text-white" type="submit" onclick="return validateFormedit()">{% trans "Save" %}</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="no_data_found hidden"></div>
        </div>
        

        <div class="pagination-content ml-55per">
            <div class="pagination">
                {% if room_data.paginator.num_pages > 1 %}
                    {% if room_data.has_previous %}
                        <a href="?page={{ room_data.previous_page_number }}">&laquo; </a>
                    {% endif %}
            
                    {% for page in room_data.paginator.page_range %}
                        <a href="?page={{ page }}" class="{% if room_data.number == page %} active {% endif %}">{{ page }}</a>
                    {% endfor %}
            
                    {% if room_data.has_next %}
                        <a href="?page={{ room_data.next_page_number }}"> &raquo;</a>
                    {% endif %}
                {% endif %}
            </div>
            
        </div>
        {% if chalet_added %}
<script>
    Toastify({
        text: `<div style="display: flex; align-items: center; margin-left:2%">
                <img src="{% static 'icons/Mask group (7).png' %}" style="margin-right: 15px;">
                <div>
                    <span style="color: #fff; font-weight: 700; font-size: 15px; display: block;">
                        {% trans "Chalet added successfully!" %}
                    </span>
                </div>
            </div>`,
        duration: 10000,  // Duration of the toast (10 seconds)
        gravity: "top",  // Position the toast at the top
        position: 'right',  // Align it to the right
        className: "custom-toast",
        offset: {
            y: "180px",  // Position the toast 180px from the top
        },
        style: {
            maxWidth: '45%',  // Max width for larger screens
            height: 'auto',  // Adjust height based on content
            background: "#18C07A",  // Green background
            borderRadius: '8px',  // Rounded corners
            display: 'flex',  // Flexbox for content alignment
            alignItems: 'center',  // Vertically align content
            padding: '16px',  // Padding for inner spacing
            color: '#fff',  // White text
            fontSize: '16px',  // Font size for the text
            animation: 'none',  // Disable any animation
        },
        stopOnFocus: true,  // Keep toast active if hovered/focused
        escapeMarkup: false  // Allow HTML content inside the text
    }).showToast();
</script>
{% endif %}
          
    <script>
        function resetFormErrors() {
            document.getElementById("pice_per_night_error1").textContent = "";
            document.getElementById("weekend_price_error").textContent = "";
        }

        document.getElementById("room_form").onsubmit = function (event) {
            const priceRegex = /^(?!0+(?:\.0{1,2})?$)([1-9]\d*(\.\d{1,2})?|0\.\d{1,2})$/;
        
            const pricePerNight = document.getElementById("pice_per_night1").value.trim();
            const weekendPrice = document.getElementById("weekend_price").value.trim();
        
            const priceError = document.getElementById("pice_per_night_error1");
            const weekendError = document.getElementById("weekend_price_error");
        
            let isValid = true;
        
            // Validate Price Per Night
            if (!priceRegex.test(pricePerNight)) {
                priceError.textContent = "{% trans 'Please enter a valid price greater than 0 (up to 2 decimal places).' %}";
                isValid = false;
            } else {
                priceError.textContent = "";
            }
        
            // Validate Weekend Price (if provided)
            if (weekendPrice && !priceRegex.test(weekendPrice)) {
                weekendError.textContent = "{% trans 'Please enter a valid weekend price greater than 0 (up to 2 decimal places).' %}";
                isValid = false;
            } else {
                weekendError.textContent = "";
            }
        
            // Prevent form submission if validation fails
            if (!isValid) {
                event.preventDefault();
            }
        };



        document.getElementById('upload-icon').addEventListener('click', function() {
            document.getElementById('standard_images-add').click();
        });

        document.getElementById('upload-icon-edit').addEventListener('click', function() {
            document.getElementById('standard_images-edit').click();
        });
        var selectedFiles = [];
        document.getElementById('standard_images-add').addEventListener('change', function() {
            var files = this.files;
            var messageContainer = document.getElementById('upload-message-add');
            const addImagesError = document.getElementById('image-add-errorr');
            var validExtensions = ['image/jpeg', 'image/png'];
            
            for (var i = 0; i < files.length; i++) {
                if (!validExtensions.includes(files[i].type)) {
                    alert("{% trans 'Only PNG and JPEG images are allowed.' %}");
                    this.value = ''; // Clear the selected files
                    return;
                }
            }

            if (selectedFiles.length + files.length > 5) {
                alert("{% trans 'You can select up to 5 images only.' %}");
                this.value = ''; // Clear the selected files
                selectedFiles = []
                messageContainer.innerHTML =''
                return;
            }

            // Add new files to the selected files list
            for (var i = 0; i < files.length; i++) {
                selectedFiles.push(files[i]);
            }
            // Create a new DataTransfer object
            var dataTransfer = new DataTransfer();
                selectedFiles.forEach(file => dataTransfer.items.add(file));

            // Assign the DataTransfer object to the input element
            var fileInput = document.getElementById('standard_images-add');
            fileInput.files = dataTransfer.files;
            // Update the message container
            messageContainer.innerHTML = selectedFiles.length + ' {% trans "image(s) uploaded." %}';
            if (selectedFiles.length < 5){
                var remainingImages = 5 - selectedFiles.length;
                addImagesError.textContent = remainingImages + ' {% trans "images remaining to upload." %}';
            }
            else{
                addImagesError.textContent = '';
            }
            

        });

        var selectedFilesEdit = [];

        document.getElementById('standard_images-edit').addEventListener('change', function() {
            var files = this.files;
            var messageContainer = document.getElementById('upload-message-edit');
            var imageError = document.getElementById('image-edit-errorr');
            var validExtensions = ['image/jpeg', 'image/png'];
            imageError.textContent = '';

            var totalFiles = selectedFilesEdit.length + files.length;

            if (totalFiles > 5) {
                alert("{% trans 'You can select up to 5 images only.' %}");
                this.value = ''; // Clear the selected files
                selectedFilesEdit=[]
                messageContainer.innerHTML = '';


                return;
            }

            var allValid = true;

            for (var i = 0; i < files.length; i++) {
                if (!validExtensions.includes(files[i].type)) {
                    allValid = false;
                    break;
                }
            }

            if (!allValid) {
                alert("{% trans 'Only PNG and JPEG images are allowed.' %}");
                this.value = ''; 
                return;
            } else {
                for (var i = 0; i < files.length; i++) {
                    selectedFilesEdit.push(files[i]);
                }
                var dataTransfer = new DataTransfer();
                selectedFilesEdit.forEach(file => dataTransfer.items.add(file));

                var fileInput = document.getElementById('standard_images-edit');
                fileInput.files = dataTransfer.files;

                messageContainer.innerHTML = selectedFilesEdit.length + ' {% trans "image(s) uploaded." %}';
            }

            if (selectedFilesEdit.length !== 5) {
                var remainingImages = 5 - selectedFilesEdit.length;
                imageError.textContent = remainingImages + ' {% trans "images remaining to upload." %}';
                
            } else {
                imageError.textContent = '';
            }

        });

        // Script to open and close sidebar
        function w3_open() {
        document.getElementById("mySidebar").style.display = "block";
        document.getElementById("myOverlay").style.display = "block";
        }
        
        function w3_close() {
        document.getElementById("mySidebar").style.display = "none";
        document.getElementById("myOverlay").style.display = "none";
        }

        
       
        function validateAndConfirm(event) {
            var roomNumber = document.getElementById("room_number").value;
            var pricePerNight = document.getElementById("pice_per_night").value;
            var images = document.getElementById("standard_images-add").files;

            var roomType = document.getElementById("roomtypes").value;
            var occupancy = document.getElementById("total_occupency").value;
            var roomNumberError = document.getElementById("room_number_error").textContent.trim();
            var isValid = true;

            document.getElementById("room_number_error").innerText = "";
            document.getElementById("pice_per_night_error").innerText = "";
            document.getElementById("image-add-errorr").innerText = "";

            document.getElementById("roomtypes_error").innerText = "";
            document.getElementById("occupancy_error").innerText = "";


          

           

            console.log(roomNumber);
            
         


            if (pricePerNight.trim() === "" || isNaN(pricePerNight) || parseFloat(pricePerNight) <= 0) {
                document.getElementById("pice_per_night_error").innerText = '{% trans "Please enter a valid amount greater than 0." %}';
                isValid = false;
            }
            else {
                document.getElementById("pice_per_night_error").innerText = "";
            }


            if (images.length !== 5) {
                document.getElementById("image-add-errorr").innerText = "{% trans 'You must upload 5 images' %}.";
                isValid = false;
            } else  {
                document.getElementById("image-add-errorr").innerText = "";
            }

            if (isValid) {
                
                if (confirm('Are you sure you want to add this room?')) {
                    showLoader();
                    document.querySelector('form.myform').submit(); 
                } else {
                    event.preventDefault();  
                }
            } else {
                event.preventDefault();  
            }
        }

        function showLoader() {
            $("#id01").hide();
            $('#loader').show();
            $('#hotelTable').addClass('blurred');

            setTimeout(function() {
                $('#loader').hide();
                $('#hotelTable').removeClass('blurred');
                
            }, 3000); 
        }
        function validateFormedit() {
            let roomNumber = document.getElementById("room_number1").value;
            let pricePerNight = document.getElementById("pice_per_night1").value;
            let roomNumberError = document.getElementById("room_number_error1");
            let pricePerNightError = document.getElementById("pice_per_night_error1");
            let originalRoomNumber = document.getElementById("original_room_number").value;

            roomNumberError.textContent = "";
            pricePerNightError.textContent = "";

            let isValid = true;

            if (!/^\d+$/.test(roomNumber)) {
                roomNumberError.textContent = "{% trans 'Room number must be digits only.' %}";
                isValid = false;
            }
            else if (roomNumber !== '' && roomNumber !== originalRoomNumber) {
                    $.ajax({
                        url: "{% url 'room_exists' %}",
                        method: 'GET',
                        data: { room_number: roomNumber },
                        async: false,  
                        success: function(response) {
                            if (response.exists) {
                                roomNumberError.textContent = "{% trans 'Room number already exists.' %}";
                                isValid = false;
                            }
                        },
                        error: function(xhr, status, error) {
                            console.error("Error fetching room data:", error);
                            isValid = false;  
                        }
                    });
                }

            if (!/^\d+(\.\d{1,2})?$/.test(pricePerNight) || parseFloat(pricePerNight) <= 0) {
                pricePerNightError.textContent = "{% trans 'Price per night must be a positive number.' %}";
                isValid = false;
            }
            const addImages = document.getElementById('standard_images-edit').files;
            console.log(addImages);
            const addImagesError = document.getElementById('image-edit-errorr');
            
            if (addImages.length > 0){
                if (addImages.length !== 5 ) {
                    console.log(addImages.length);
                    addImagesError.textContent = '{% trans "You must upload 5 images." %}';
                    isValid = false;
                } else {
                    addImagesError.textContent = '';
                    editImagesError.textContent = '';
                }
            }

            return isValid;
        }
        

           

        document.addEventListener('DOMContentLoaded', function() {
            const amenitiesInput = document.getElementById('amenities');
            const dropdownMenu = document.getElementById('amenitiesDropdown');

            amenitiesInput.addEventListener('click', function() {
                dropdownMenu.classList.toggle('show');
            });

            document.addEventListener('click', function(event) {
                if (!dropdownMenu.contains(event.target) && event.target !== amenitiesInput) {
                    dropdownMenu.classList.remove('show');
                }
            });

            const checkboxes = document.querySelectorAll('.amenities_checkbox');
            checkboxes.forEach(function(checkbox) {
                checkbox.addEventListener('change', function() {
                    let selected = [];
                    checkboxes.forEach(function(cb) {
                        if (cb.checked) {
                            selected.push(cb.nextSibling.textContent.trim());
                        }
                    });
                    amenitiesInput.value = selected.join(', ');
                });
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
            const amenitiesInput = document.getElementById('amenitiesedit');
            const amenitiesDropdown = document.getElementById('amenitiesDropdownedit');

            amenitiesInput.addEventListener('click', function() {
                amenitiesDropdown.classList.toggle('show');
            });

            document.addEventListener('click', function(event) {
                if (!amenitiesInput.contains(event.target) && !amenitiesDropdown.contains(event.target)) {
                    amenitiesDropdown.classList.remove('show');
                }
            });

            const checkboxes = amenitiesDropdown.querySelectorAll('input[name="amenitiesedit"]');
            checkboxes.forEach(function(checkbox) {
                checkbox.addEventListener('change', function() {
                    let selected = [];
                    checkboxes.forEach(function(cb) {
                        if (cb.checked) {
                            selected.push(cb.nextSibling.textContent.trim());
                        }
                    });
                    amenitiesInput.value = selected.join(', ');
                });
            });
        });

        function fetch_data(id){
            resetFormErrors(); 
            $.ajax({
                url :  "{% url 'chalet_info' chalet_id='1' %}".replace('1', id),
                method : "GET",
                success: function(data) {
                    $("#room_form").attr('action', "{% url 'chalet_info' chalet_id='1' %}".replace('1', id))
                    $("#pice_per_night1").val(data.total_price);
                    $("#weekend_price").val(data.weekend_price)

                    let selectedAmenities = [];
                    const currentLanguage = '{{ request.LANGUAGE_CODE }}';

                    $('#amenitiesDropdownedit input[type="checkbox"]').each(function() {
                        var amenity = $(this).val();
                        var $checkbox = $(this);
                        
                        console.log("Checkbox value:", amenity);
                        console.log("data.amenities:", data.amenities);

                        data.amenities.forEach(function(amenityData) {
                            console.log("Checking against data.amenities:", amenityData);
                            if (amenityData.english === amenity) {
                                $checkbox.prop('checked', true);
                                
                                if (currentLanguage === 'en') {
                                    selectedAmenities.push(amenity);
                                } else {
                                    selectedAmenities.push(amenityData.arabic);
                                }

                                console.log("Selected amenities so far:", selectedAmenities);
                            }
                        });
                    });

                    $('#amenitiesedit').val(selectedAmenities.join(', '));
                },
                error: function() {
                    console.log('Failed to fetch details.');
                }

            })
        }
        
        $(document).ready(function() {
            $('#cancel_button').click(function() {
                location.reload();
            });
        });


        $(document).ready(function() {
            $('#room_number').on('input',function() {
                var roomNumber = $(this).val().trim();
                if (roomNumber !== '') {
                    $.ajax({
                        url: "{% url 'room_exists' %}",
                        method: 'GET',
                        data: { 'room_number': roomNumber },
                        success: function(response) {
                            if (response.exists) {
                                $('#room_number_error').text('{% trans "Room number already exists." %}').show();
                            } else {
                                $('#room_number_error').text('')
                            }
                        },
                        error: function(xhr, status, error) {
                            console.error("Error fetching room data:", error);
                        }
                    });
                } else {
                    $('#room_number_error').text('').hide();
                }
            });
        });


        $(document).ready(function() {
            $('#roomtypes').on('change', function() {
                var roomType = $(this).val();
                console.log(roomType);
                if (roomType !== '') {
                    fetchRoomData(roomType);
                }
            });

                var roomType = $('#roomtypes').val(); 
                if (roomType !== '') {
                    fetchRoomData(roomType);
                    
                }
        });
        function fetchRoomData(roomType) {
            $.ajax({
                url: "{% url 'room_add' %}",
                method: 'GET',
                data: { room_type: roomType },
                success: function(data) {
                    console.log(data);
                    $('#total_occupancy').val(data.total_occupency);
                    $('#pice_per_night').val(data.price_per_night);
                    $('#pice_per_night_breakfast').val(data.price_per_night_bf);
                    $('#pice_per_night_bf_dinner').val(data.price_per_night_bf_dinner);
                },
                error: function(xhr, status, error) {
                    console.error("Error fetching room data:", error);
                }
            });
        }

        // document.addEventListener('DOMContentLoaded', function() {
        //     flatpickr("#datePicker", {
        //         enableTime: false,  
        //         dateFormat: "Y-m-d"

        //     });
        //     flatpickr("#datePicker1", {
        //         enableTime: false,  
        //         dateFormat: "Y-m-d"

        //     });
        // });
        
        // function resetDate(dateId) {
        //     document.getElementById(dateId).value = '';
        // }

        $(document).ready(function(){
            $('.search_button').click(function(event){
                event.preventDefault();
                var roomtype_value = $('.select_roomtype').val();
                var active_btn_id = $('.btn.activee').attr('id');
                passvalue(roomtype_value,active_btn_id)
                
            })

            function passvalue(roomtype_value=null,active_btn_id){
                $('#loader').show();
                $('#hotelTable').addClass('blurred');

                var loaderTimeout = setTimeout(function() {
                    $('#loader').hide();
                    $('#hotelTable').removeClass('blurred');
                }, 1000);
                setTimeout(function() {
                    $.ajax({
                        url:'{%url "chalet_management" %}',
                        type:'POST',
                        headers: {
                            'X-CSRFToken': window.CSRF_TOKEN
                        },
                        data:{
                            "roomtype_value":roomtype_value,
                            
                            "active_btn_id":active_btn_id
                        },
                        dataType:'json',
                        success: function(response) {
                            clearTimeout(loaderTimeout);
                            $('#loader').hide();
                            $('#hotelTable').removeClass('blurred');

                            let table_body = $(".table_body");
                            table_body.empty();

                            if (response.rooms.length > 0) {
                                let counter = 1
                                response.rooms.forEach(function(room) {
                                    console.log(room);
                                    let editTd = '';
                                    let deleteTd = '';
                                    if (room.is_available_view) {
                                        editTd = `<td class="color-grey">
                                            <a href="#" data-room_id="${room.id}" onclick="fetch_data(this.getAttribute('data-room_id')); document.getElementById('id02').style.display='block';" style="text-decoration: none;">
                                                <i class="fa-solid fa-pen"></i> Edit
                                            </a>
                                        </td>`;
                                        deleteTd = `<td class="color-grey">
                                            <a href="delete/${room.id}/" onclick="return confirm('Are you sure you want to delete this room?');" style="text-decoration: none;">
                                                <i class="fa-solid fa-trash"></i> Delete
                                            </a>
                                        </td>`;
                                    }
                                    
                                    let row = `<tr>
                                        <td class="border-right">${counter}</td>
                                        <td class="border-right">${room.roomtypes}</td>
                                        <td class="data_roomnumber border-right">${room.room_number}</td>
                                        <td class="border-right data_occupancy">${room.occupancy}</td>
                                        <td class="border-right">${room.price}</td>
                                        <td class="border-right">${room.commission_amount}</td>
                                        <td class="border-right">${room.total_room_price}</td>
                                        ${editTd}
                                        ${deleteTd}
                                    </tr>`;
                                    
                                    table_body.append(row);
                                    counter++;
                                });
                                $('.no_data_found').hide();
                            } else {
                                let noDataRow = `<tr><td colspan="8" style="text-align: center;">No data found</td></tr>`;
                                table_body.append(noDataRow);

                            }
                        },
                        error:function(xhr,status,error){
                            clearTimeout(loaderTimeout);
                            $('#loader').hide();
                            console.error('error :',error);
                        }
                    });
                }, 500); 
            }
            
        });
        
        $(document).ready(function(){
            $('.booked_button').click(function(event){
                event.preventDefault();
                // Hide the last column header and all its corresponding cells
                $('#add_button').hide();
                $('th:last-child').remove();

                $('.border-right.last_col').removeClass('border-right');
                booked_data();
            });

            $('.available_button').click(function(event){
                event.preventDefault();
                $('#loader').show();
                $('#hotelTable').addClass('blurred');
                setTimeout(function() {
                    location.reload();
                }, 500); 
            });

            function booked_data() {
                $('#loader').show();
                $('#hotelTable').addClass('blurred');
                var loaderTimeout = setTimeout(function() {
                    $('#loader').hide();
                    $('#hotelTable').removeClass('blurred');
                }, 1000);

                setTimeout(function() {
                    $.ajax({
                        url: '{% url "chalet_booked" %}',
                        type: 'GET',
                        success: function(data) {
                            clearTimeout(loaderTimeout);
                            $('#loader').hide();
                            $('#hotelTable').removeClass('blurred');

                            var tableContent = $(data).find('table tbody').html();
                            var paginationContent = $(data).find('.pagination-content').html(); // Retrieve pagination content

                            if ($.trim(tableContent).length > 0) {
                                $('table tbody').html(tableContent);
                                $('.no_data_found').hide(); 
                                $('.pagination-content').hide(); // Hide pagination
                            } else {
                                $('table tbody').html('<tr><td colspan="7" style="text-align: center;">No data found</td></tr>');
                                $('.pagination-content').hide(); // Hide pagination
                            }
                            $('.btn').removeClass('activee');
                            $('.booked_button').addClass('activee');
                        },
                        error: function(xhr, status, error) {
                            console.error('error :', error);
                        }
                    });
                }, 500);
            }
        });

    </script>
</body>
</html>